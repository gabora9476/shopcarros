<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="siteTitle">AutoVentas - Vehículos Premium</title>
    <!-- Favicon principal -->
<link rel="icon" type="image/png" href="https://i.ibb.co/CsQzrK0S/favicon-96x96.png">

<!-- Favicon para navegadores antiguos -->
<link rel="shortcut icon" type="image/png" href="https://i.ibb.co/CsQzrK0S/favicon-96x96.png">

<!-- Icono para dispositivos Apple (iOS) -->
<link rel="apple-touch-icon" href="https://i.ibb.co/CsQzrK0S/favicon-96x96.png">

<!-- Color del tema para navegadores móviles -->
<meta name="theme-color" content="#00d4ff">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, onSnapshot, query, orderBy, where, limit } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js';

        // Tu configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBXeCPK4QMMD87BcbVlWp_D2rzusKTxEso",
            authDomain: "autoventas-c9168.firebaseapp.com",
            projectId: "autoventas-c9168",
            storageBucket: "autoventas-c9168.firebasestorage.app",
            messagingSenderId: "939292107035",
            appId: "1:939292107035:web:7bd26de7951b225c9773be",
            measurementId: "G-SXWF2M105G"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Hacer disponibles globalmente
        window.db = db;
        window.storage = storage;
        window.firebaseModules = {
            collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, onSnapshot, query, orderBy, where, limit,
            ref, uploadBytes, getDownloadURL
        };
    </script>

    <style>
        :root {
            --primary-color: #00d4ff;
            --secondary-color: #ff6b35;
            --accent-color: #ffd700;
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-surface: #262626;
            --text-color: #ffffff;
            --text-muted: #888;
            --text-secondary: #b0b0b0;
            --border-color: #333;
            --border-light: #444;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --error-color: #dc3545;
            --info-color: #17a2b8;
            --shadow-light: rgba(0, 212, 255, 0.1);
            --shadow-medium: rgba(0, 212, 255, 0.2);
            --shadow-heavy: rgba(0, 212, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-card) 100%);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 15, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1rem;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Header Styles */
        .header {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            gap: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            display: none;
            transition: transform 0.3s ease;
        }

        .logo-image:hover {
            transform: scale(1.1);
        }

        .logo {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        /* Banner Styles */
        .header.banner-style-1 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .header.banner-style-2 {
            background: var(--bg-card);
            border-bottom: 3px solid var(--primary-color);
        }

        .header.banner-style-3 {
            background: linear-gradient(90deg, var(--bg-dark), var(--primary-color), var(--bg-dark));
        }

        .header.banner-style-4 {
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 20px var(--primary-color);
        }

        .header.banner-style-5 {
            background: linear-gradient(45deg, #2d2d2d, #4a4a4a);
            border-bottom: 2px solid var(--secondary-color);
        }

        /* Search Toggle Button - Solo visible en catálogo */
        .search-toggle-btn {
            position: fixed;
            top: 120px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 200;
            box-shadow: 0 8px 25px var(--shadow-medium);
            transition: all 0.3s ease;
            display: none;
        }

        .search-toggle-btn:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 12px 35px var(--shadow-heavy);
        }

        .search-toggle-btn.active {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
        }

        /* Search and Filter Section - Mejorado para móviles */
        .search-filter-section {
            background: rgba(26, 26, 26, 0.98);
            backdrop-filter: blur(15px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            transform: translateY(-100%);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 150;
            border-bottom: 2px solid var(--primary-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding-top: 90px;
        }

        .search-filter-section.active {
            transform: translateY(0);
        }

        .search-filter-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            border-radius: 30px;
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px var(--shadow-light);
            transform: translateY(-2px);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .clear-search-btn {
            padding: 15px 25px;
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid var(--secondary-color);
            border-radius: 30px;
            color: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            white-space: nowrap;
        }

        .clear-search-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        /* Filter Controls - Mejorado para móviles */
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-label {
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select, .filter-input {
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px var(--shadow-light);
            transform: translateY(-2px);
        }

        .filter-select option {
            background: var(--bg-card);
            color: white;
            padding: 10px;
        }

        .sort-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }

        .sort-controls-label {
            color: var(--text-secondary);
            font-weight: 700;
            margin-right: 15px;
            font-size: 1rem;
            white-space: nowrap;
        }

        .sort-btn {
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            border-radius: 25px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .sort-btn.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-light);
        }

        .sort-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            color: white;
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        .search-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid var(--secondary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-close-btn:hover {
            background: rgba(255, 107, 53, 0.4);
            transform: scale(1.1);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .nav-btn, .publish-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--shadow-light);
            white-space: nowrap;
        }

        .nav-btn:hover, .publish-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px var(--shadow-medium);
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-light);
            box-shadow: none;
        }

        .nav-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #666;
        }

        .nav-btn.admin {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .logout-btn {
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
        }

        .logout-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            transform: translateY(-2px);
        }

        /* Container and Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-content {
            margin: 40px 0;
            padding-top: 20px;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Publicidad Section - Nueva funcionalidad */
        .advertising-section {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            padding: 30px;
            margin: 50px 0;
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .advertising-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        .advertising-section:hover {
            border-color: var(--primary-color);
            box-shadow: 0 15px 40px var(--shadow-medium);
            transform: translateY(-5px);
        }

        .advertising-content {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .advertising-image {
            flex: 0 0 200px;
            height: 150px;
            border-radius: 15px;
            object-fit: cover;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .advertising-info {
            flex: 1;
        }

        .advertising-title {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .advertising-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .advertising-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .advertising-btn {
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .advertising-btn.whatsapp {
            background: linear-gradient(45deg, #25D366, #128C7E);
            color: white;
            border: none;
        }

        .advertising-btn.website {
            background: linear-gradient(45deg, var(--primary-color), var(--info-color));
            color: white;
            border: none;
        }

        .advertising-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .advertising-label {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Featured Section - Mejorado y más llamativo */
        .featured-section {
            margin: 60px 0;
            position: relative;
        }

        .featured-section::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .featured-title {
            text-align: center;
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 40px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px var(--shadow-light);
            position: relative;
        }

        .featured-title::after {
            content: '⭐';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.7; transform: translateX(-50%) scale(1.2); }
        }

        .featured-subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.2rem;
            margin-bottom: 40px;
            font-style: italic;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 35px;
            margin-bottom: 50px;
        }
        /* Notification System - Mejorado */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 30px;
            border-radius: 20px;
            color: white;
            font-weight: 700;
            z-index: 10000;
            animation: slideIn 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            max-width: 420px;
            word-wrap: break-word;
            font-size: 1rem;
        }

        .notification.success {
            background: linear-gradient(45deg, var(--success-color), #20c997);
            border-left: 5px solid #28a745;
        }

        .notification.error {
            background: linear-gradient(45deg, var(--error-color), var(--secondary-color));
            border-left: 5px solid #dc3545;
        }

        .notification.info {
            background: linear-gradient(45deg, var(--primary-color), var(--info-color));
            border-left: 5px solid #00d4ff;
        }

        .notification.warning {
            background: linear-gradient(45deg, var(--warning-color), #fd7e14);
            border-left: 5px solid #ffc107;
            color: #000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Dashboard Styles - Mejorado */
        .dashboard-container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 25px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            border: 2px solid var(--border-color);
        }

        .dashboard-title {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
        }

        .dashboard-subtitle {
            color: var(--text-muted);
            font-size: 1.3rem;
            font-style: italic;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px var(--shadow-light);
            border-color: var(--primary-color);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: block;
            text-shadow: 0 0 20px var(--shadow-light);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .dashboard-card {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px var(--shadow-light);
            border-color: var(--primary-color);
        }

        .dashboard-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            border-bottom: 2px solid var(--border-color);
            background: rgba(255, 255, 255, 0.05);
        }

        .dashboard-card-title {
            font-weight: 800;
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .dashboard-card-body {
            padding: 25px;
        }

        .dashboard-vehicle-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .dashboard-vehicle-image:hover {
            transform: scale(1.05);
        }

        .dashboard-vehicle-price {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .dashboard-vehicle-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .dashboard-vehicle-location {
            color: var(--text-muted);
            font-size: 1rem;
            font-weight: 600;
        }

        .dashboard-vehicle-date {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .dashboard-status-message {
            background: rgba(255, 193, 7, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--warning-color);
        }

        .dashboard-message-label {
            color: var(--warning-color);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dashboard-message-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .card-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 18px;
            border: none;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-edit {
            background: rgba(0, 212, 255, 0.2);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-edit:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .btn-delete {
            background: rgba(255, 107, 53, 0.2);
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
        }

        .btn-delete:hover {
            background: rgba(255, 107, 53, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-sold {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        .btn-sold:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-sold.active {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
            color: white;
            border-color: var(--accent-color);
        }

        .btn-approve {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .btn-approve:hover {
            background: rgba(40, 167, 69, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-reject {
            background: rgba(220, 53, 69, 0.2);
            color: var(--error-color);
            border: 2px solid var(--error-color);
        }

        .btn-reject:hover {
            background: rgba(220, 53, 69, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-featured {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        .btn-featured:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-featured.active {
            background: linear-gradient(45deg, var(--accent-color), #ff8c00);
            color: white;
            border-color: var(--accent-color);
        }

        /* Admin Panel Styles - Mejorado */
        .admin-panel {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            padding: 40px;
            margin: 25px 0;
            border: 2px solid var(--border-color);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 40px;
            border-bottom: 3px solid var(--border-color);
            flex-wrap: wrap;
            padding-bottom: 15px;
        }

        .admin-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 1rem;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-tab:hover {
            color: var(--primary-color);
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-2px);
        }

        .admin-tab.active {
            color: var(--primary-color);
            background: rgba(0, 212, 255, 0.2);
            border-bottom: 3px solid var(--primary-color);
            transform: translateY(-2px);
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-content h3 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-section-description {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
            font-style: italic;
        }
        /* Data Table Styles - Mejorado */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-color);
        }

        .data-table th,
        .data-table td {
            padding: 18px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .data-table th {
            background: linear-gradient(45deg, rgba(0, 212, 255, 0.2), rgba(255, 107, 53, 0.1));
            color: var(--primary-color);
            font-weight: 800;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr {
            transition: all 0.3s ease;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.01);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .whatsapp-link:hover {
            text-decoration: underline;
            color: #20c55e;
            transform: scale(1.05);
        }

        .whatsapp-link::before {
            content: '📱';
            font-size: 1.1rem;
        }

        /* Customization Styles - Mejorado */
        .customization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 35px;
        }

        .customization-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .customization-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px 20px 0 0;
        }

        .customization-section:hover {
            border-color: var(--primary-color);
            box-shadow: 0 15px 35px var(--shadow-light);
            transform: translateY(-5px);
        }

        .customization-section h4 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.4rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .color-controls {
            display: grid;
            gap: 25px;
        }

        .color-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .color-input-group:hover {
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.08);
        }

        .color-input {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .color-input:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .banner-styles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
        }

        .banner-option {
            background: none;
            border: 3px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .banner-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .banner-option:hover::before {
            transform: translateX(100%);
        }

        .banner-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow-light);
        }

        .banner-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 20px var(--shadow-light);
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-5px);
        }

        .banner-preview {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            color: white;
            font-weight: 700;
            margin-bottom: 12px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .banner-option-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Advertising Management Styles - Nueva funcionalidad */
        .advertising-management {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            border: 2px solid var(--border-color);
        }

        .advertising-form {
            display: grid;
            gap: 25px;
        }

        .advertising-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .advertising-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 2px dashed var(--border-color);
            margin-top: 20px;
        }

        .advertising-preview h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .advertising-image-upload {
            position: relative;
            border: 2px dashed var(--border-light);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.03);
        }

        .advertising-image-upload:hover {
            border-color: var(--primary-color);
            background: rgba(0, 212, 255, 0.05);
            transform: translateY(-2px);
        }

        .advertising-image-upload.has-image {
            border-color: var(--success-color);
            border-style: solid;
        }

        .advertising-upload-text {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .advertising-upload-hint {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .advertising-current-image {
            max-width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
        }

        /* Modal Styles - Mejorado para móviles */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.4s ease;
            padding: 20px;
        }

        .modal {
            display: flex;
            width: 95%;
            max-width: 1300px;
            height: 90vh;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            overflow: hidden;
            border: 3px solid var(--border-color);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .auth-modal, .publish-modal, .edit-modal, .verification-modal, .advertising-modal {
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
            border-radius: 25px;
            padding: 45px;
            border: 3px solid var(--border-color);
            position: relative;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }

        .image-section {
            flex: 2;
            position: relative;
            background: #000;
            min-height: 400px;
            border-radius: 0 0 0 25px;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.02);
        }

        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: none;
            color: white;
            font-size: 2.5rem;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border-radius: 0;
            z-index: 10;
        }

        .image-nav:hover {
            background: rgba(0, 212, 255, 0.9);
            transform: translateY(-50%) scale(1.1);
            color: white;
        }

        .prev {
            left: 0;
            border-radius: 0 20px 20px 0;
        }

        .next {
            right: 0;
            border-radius: 20px 0 0 20px;
        }

        .details-section {
            flex: 1;
            padding: 35px;
            overflow-y: auto;
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-dark) 100%);
            border-radius: 0 0 25px 0;
        }

        .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.8);
            border: none;
            color: white;
            font-size: 2.8rem;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .close-btn:hover {
            background: rgba(255, 107, 53, 0.9);
            transform: rotate(90deg) scale(1.1);
            border-color: var(--secondary-color);
        }

        .vehicle-title {
            font-size: 2.4rem;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-weight: 800;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
            line-height: 1.5;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .detail-item:hover {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 10px;
            border-radius: 10px;
            border-bottom: 1px solid var(--primary-color);
        }

        .detail-icon {
            margin-right: 15px;
            font-size: 1.4rem;
            width: 30px;
            text-align: center;
            color: var(--primary-color);
        }

        .detail-label {
            font-weight: 800;
            margin-right: 12px;
            min-width: 130px;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .detail-dots {
            flex: 1;
            border-bottom: 2px dotted var(--border-light);
            margin: 0 12px;
            height: 1px;
        }

        .detail-value {
            font-weight: 700;
            color: white;
            font-size: 1.05rem;
        }

        .price-modal {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 40px var(--shadow-light);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .thumbnails {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 90%;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .thumbnail {
            width: 70px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .thumbnail.active,
        .thumbnail:hover {
            opacity: 1;
            border-color: var(--primary-color);
            transform: scale(1.15);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.5);
        }
        /* Contact Section - Mejorado */
        .contact-section {
            margin-top: 35px;
            padding: 30px;
            background: linear-gradient(45deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 53, 0.1));
            border-radius: 20px;
            border: 2px solid var(--primary-color);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .contact-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .contact-section:hover::before {
            left: 100%;
        }

        .contact-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #25D366, #128C7E);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1.4rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 18px;
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .contact-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(37, 211, 102, 0.6);
            background: linear-gradient(45deg, #128C7E, #25D366);
        }

        .contact-note {
            font-size: 1rem;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.6;
            font-style: italic;
            position: relative;
            z-index: 1;
        }

        /* Form Styles - Mejorado */
        .form-title {
            text-align: center;
            font-size: 2.8rem;
            margin-bottom: 40px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 18px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 600;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px var(--shadow-light);
            transform: translateY(-3px);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--text-muted);
            font-weight: 500;
        }

        .form-textarea {
            resize: vertical;
            min-height: 140px;
            line-height: 1.6;
        }

        .form-select option {
            background: var(--bg-card);
            color: white;
            padding: 12px;
            font-weight: 600;
        }

        .form-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1.3rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 18px;
            box-shadow: 0 8px 25px var(--shadow-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .form-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .form-btn:hover::before {
            left: 100%;
        }

        .form-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow-medium);
        }

        .form-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .form-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-light);
            box-shadow: none;
        }

        .form-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--border-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .separator {
            margin: 40px 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), var(--secondary-color), transparent);
            border-radius: 3px;
            position: relative;
        }

        .separator::before {
            content: '✦';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            color: var(--primary-color);
            padding: 5px 10px;
            font-size: 1.2rem;
        }

        /* Image Upload Styles - Mejorado */
        .image-upload-area {
            border: 3px dashed var(--border-light);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.03);
            position: relative;
            overflow: hidden;
        }

        .image-upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .image-upload-area:hover::before {
            transform: translateX(100%);
        }

        .image-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .image-upload-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .image-upload-hint {
            font-size: 1rem;
            color: var(--text-muted);
            font-style: italic;
            position: relative;
            z-index: 1;
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .image-preview {
            position: relative;
            width: 140px;
            height: 105px;
            border-radius: 15px;
            overflow: hidden;
            border: 3px solid var(--border-color);
            transition: all 0.3s ease;
            background: var(--bg-surface);
        }

        .image-preview:hover {
            border-color: var(--primary-color);
            transform: scale(1.08);
            box-shadow: 0 10px 25px var(--shadow-light);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-preview:hover img {
            transform: scale(1.1);
        }

        .remove-image {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--secondary-color);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 800;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-image:hover {
            background: var(--error-color);
            transform: scale(1.2);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.5);
        }

        /* Verification Styles - Mejorado */
        .verification-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 35px;
            border: 2px solid var(--border-color);
            position: relative;
        }

        .verification-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px 20px 0 0;
        }

        .verification-info h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px dotted var(--border-light);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 10px;
            border-radius: 10px;
        }

        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 700;
            color: var(--text-muted);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-weight: 800;
            color: white;
            text-align: right;
            font-size: 1.05rem;
        }

        .verification-actions {
            text-align: center;
        }

        .verification-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .verification-buttons .form-btn {
            margin-bottom: 0;
        }

        /* Error and Success Messages - Mejorado */
        .error-message {
            color: var(--error-color);
            font-size: 1rem;
            margin-top: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .error-message::before {
            content: '⚠️';
            font-size: 1.1rem;
        }

        .success-message {
            color: var(--success-color);
            font-size: 1rem;
            margin-top: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .success-message::before {
            content: '✅';
            font-size: 1.1rem;
        }

        .warning-message {
            color: var(--warning-color);
            font-size: 1rem;
            margin-top: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-message::before {
            content: '⚠️';
            font-size: 1.1rem;
        }

        /* Publication Status Styles - Mejorado */
        .publication-status {
            padding: 20px 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 800;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .publication-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .publication-status:hover::before {
            left: 100%;
        }

        .publication-status.pending {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid var(--warning-color);
            color: var(--warning-color);
        }

        .publication-status.approved {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid var(--success-color);
            color: var(--success-color);
        }

        .publication-status.rejected {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid var(--error-color);
            color: var(--error-color);
        }
        /* Mobile Responsive Styles - Mejorado y más completo */
        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .nav-buttons {
                justify-content: center;
                width: 100%;
            }

            .search-toggle-btn {
                top: 140px;
                right: 15px;
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }

            .featured-title {
                font-size: 2.5rem;
            }

            .catalog-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 25px;
            }

            .dashboard-stats {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .modal {
                flex-direction: column;
                width: 98%;
                height: 95vh;
                border-radius: 20px;
            }
            
            .image-section {
                flex: 1;
                min-height: 250px;
                border-radius: 20px 20px 0 0;
            }
            
            .details-section {
                flex: 1;
                padding: 25px;
                border-radius: 0 0 20px 20px;
            }
            
            .image-nav {
                font-size: 2rem;
                padding: 15px;
            }

            .close-btn {
                width: 50px;
                height: 50px;
                font-size: 2.2rem;
                top: 15px;
                right: 15px;
            }

            .auth-modal, .publish-modal, .edit-modal, .verification-modal, .advertising-modal {
                width: 95%;
                padding: 30px;
                max-height: 95vh;
                border-radius: 20px;
            }

            .form-title {
                font-size: 2.2rem;
                margin-bottom: 30px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .thumbnails {
                flex-wrap: wrap;
                max-width: 95%;
                padding: 10px;
                gap: 8px;
            }

            .thumbnail {
                width: 60px;
                height: 40px;
            }

            .detail-item {
                font-size: 1rem;
            }

            .detail-label {
                min-width: 100px;
                font-size: 0.9rem;
            }

            .vehicle-title {
                font-size: 2rem;
                margin-bottom: 25px;
            }

            .price-modal {
                font-size: 2.5rem;
                margin: 25px 0;
            }

            .verification-buttons {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .image-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }

            .image-preview {
                width: 120px;
                height: 90px;
            }

            .search-filter-container {
                padding: 25px 15px;
            }

            .search-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                min-width: auto;
                font-size: 1rem;
                padding: 15px 20px;
            }

            .clear-search-btn {
                align-self: center;
                min-width: 200px;
            }

            .sort-controls {
                justify-content: center;
                gap: 8px;
            }

            .sort-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .filter-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .nav-buttons {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .social-links {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .social-link {
                min-width: 250px;
                padding: 15px 25px;
            }

            .dashboard-stats {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .dashboard-card-body {
                padding: 20px;
            }

            .admin-tabs {
                flex-direction: column;
                gap: 8px;
            }

            .admin-tab {
                border-radius: 15px;
                text-align: center;
                padding: 12px 20px;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th,
            .data-table td {
                padding: 12px 10px;
            }

            .admin-actions {
                flex-direction: column;
                gap: 8px;
            }

            .btn-small {
                text-align: center;
                min-width: 120px;
            }

            .customization-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .banner-styles {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .banner-option {
                padding: 15px;
            }

            .catalog-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 20px;
                padding: 0 5px;
            }

            .featured-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .featured-title {
                font-size: 2.2rem;
            }

            .notification {
                right: 10px;
                left: 10px;
                top: 10px;
                max-width: none;
                padding: 15px 20px;
                font-size: 0.95rem;
                border-radius: 15px;
            }

            .vehicle-card {
                border-radius: 20px;
            }

            .vehicle-info {
                padding: 20px;
            }

            .vehicle-price {
                font-size: 1.8rem;
            }

            .advertising-section {
                margin: 40px 0;
                padding: 25px;
                border-radius: 20px;
            }

            .advertising-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .advertising-image {
                flex: none;
                width: 100%;
                height: 200px;
                max-width: 300px;
                margin: 0 auto;
            }

            .advertising-title {
                font-size: 1.5rem;
            }

            .advertising-description {
                font-size: 1rem;
            }

            .advertising-actions {
                justify-content: center;
            }

            .advertising-form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .image-upload-area {
                padding: 40px 20px;
            }

            .color-input {
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }

            .header-content {
                padding: 10px 15px;
            }

            .logo {
                font-size: 1.6rem;
            }

            .search-toggle-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
                top: 130px;
                right: 10px;
            }

            .search-filter-container {
                padding: 20px 10px;
            }

            .search-close-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
                top: 15px;
                right: 15px;
            }

            .featured-title {
                font-size: 1.8rem;
                margin-bottom: 30px;
            }

            .catalog-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0;
            }

            .vehicle-card {
                margin: 0 5px;
            }

            .vehicle-image-container {
                height: 180px;
            }

            .vehicle-info {
                padding: 15px;
            }

            .vehicle-price {
                font-size: 1.6rem;
            }

            .vehicle-model {
                font-size: 1.2rem;
            }

            .dashboard-container {
                padding: 15px;
            }

            .dashboard-header {
                padding: 20px;
                margin-bottom: 30px;
            }

            .dashboard-title {
                font-size: 2.2rem;
            }

            .dashboard-subtitle {
                font-size: 1.1rem;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-number {
                font-size: 2.5rem;
            }

            .admin-panel {
                padding: 25px;
                margin: 15px 0;
            }

            .admin-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
                font-size: 0.8rem;
            }

            .form-input, .form-textarea, .form-select {
                padding: 15px 20px;
                font-size: 1rem;
            }

            .form-btn {
                padding: 18px;
                font-size: 1.1rem;
            }

            .image-upload-area {
                padding: 30px 15px;
            }

            .image-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
            }

            .image-preview {
                width: 100px;
                height: 75px;
            }

            .advertising-section {
                padding: 20px;
                margin: 30px 0;
            }

            .advertising-title {
                font-size: 1.3rem;
            }

            .advertising-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .social-section {
                padding: 30px 0;
            }

            .social-title {
                font-size: 1.8rem;
            }

            .social-link {
                min-width: 200px;
                padding: 12px 20px;
                font-size: 1rem;
            }

            .notification {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }

        /* Animaciones adicionales */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .featured-section {
            animation: slideInUp 0.6s ease-out;
        }

        .vehicle-card.featured {
            animation: float 3s ease-in-out infinite;
        }

        .search-toggle-btn {
            animation: float 2s ease-in-out infinite;
        }

        /* Estados de carga mejorados */
        .loading-skeleton {
            background: linear-gradient(90deg, var(--bg-surface) 25%, var(--border-color) 50%, var(--bg-surface) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 15px;
        }

        .vehicle-card.loading {
            pointer-events: none;
        }

        .vehicle-card.loading .vehicle-image {
            background: var(--bg-surface);
            animation: shimmer 1.5s infinite;
        }

        /* Mejoras de accesibilidad */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles mejorados */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        .vehicle-card:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 5px;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --bg-dark: #000000;
                --bg-card: #111111;
                --text-color: #ffffff;
                --border-color: #ffffff;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Cargando AutoVentas...</div>
        </div>
    </div>

    <!-- Search Toggle Button - Solo visible en catálogo -->
    <button class="search-toggle-btn" id="searchToggleBtn" onclick="toggleSearchPanel()" aria-label="Abrir panel de búsqueda">
        🔍
    </button>

    <!-- Header -->
    <header class="header" id="headerElement">
        <div class="header-content">
            <div class="logo-container">
                <img id="logoImage" class="logo-image" src="" alt="Logo" style="display: none;">
                <h1 class="logo" id="logoText">🏎️ AutoVentas Premium</h1>
            </div>
            <div class="user-info">
                <span id="userWelcome" style="display: none;"></span>
                <div class="nav-buttons">
                    <button class="nav-btn" id="catalogBtn" onclick="showSection('catalog')">🏠 Catálogo</button>
                    <button class="nav-btn secondary" id="dashboardBtn" onclick="showSection('dashboard')" style="display: none;">📊 Mi Dashboard</button>
                    <button class="nav-btn admin" id="adminBtn" onclick="showSection('admin')" style="display: none;">⚙️ Admin</button>
                    <button class="publish-btn" onclick="handlePublishClick()">📝 Publicar Vehículo</button>
                </div>
                <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">Cerrar Sesión</button>
            </div>
        </div>
    </header>

    <!-- Search and Filter Section - Mejorado con toggle -->
    <div class="search-filter-section" id="searchFilterSection">
        <button class="search-close-btn" onclick="toggleSearchPanel()" aria-label="Cerrar panel de búsqueda">
            ✕
        </button>
        <div class="search-filter-container">
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="🔍 Buscar por marca, modelo o año..." onkeyup="handleSearch()" aria-label="Buscar vehículos">
                <button class="clear-search-btn" onclick="clearSearch()">🗑️ Limpiar</button>
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label class="filter-label" for="brandFilter">🏭 Marca</label>
                    <select class="filter-select" id="brandFilter" onchange="applyFilters()" aria-label="Filtrar por marca">
                        <option value="">Todas las marcas</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label" for="modelFilter">🚗 Modelo</label>
                    <select class="filter-select" id="modelFilter" onchange="applyFilters()" aria-label="Filtrar por modelo">
                        <option value="">Todos los modelos</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label" for="yearFilter">📅 Año</label>
                    <select class="filter-select" id="yearFilter" onchange="applyFilters()" aria-label="Filtrar por año">
                        <option value="">Todos los años</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label" for="priceFilter">💰 Precio Máximo</label>
                    <input type="number" class="filter-input" id="priceFilter" placeholder="Ej: 50000" onchange="applyFilters()" aria-label="Filtrar por precio máximo">
                </div>
            </div>
            
            <div class="sort-controls">
                <span class="sort-controls-label">📊 Ordenar por:</span>
                <button class="sort-btn active" onclick="setSortOrder('newest')" id="sortNewest">🆕 Más recientes</button>
                <button class="sort-btn" onclick="setSortOrder('oldest')" id="sortOldest">📅 Más antiguos</button>
                <button class="sort-btn" onclick="setSortOrder('price-low')" id="sortPriceLow">💰 Menor precio</button>
                <button class="sort-btn" onclick="setSortOrder('price-high')" id="sortPriceHigh">💎 Mayor precio</button>
                <button class="sort-btn" onclick="setSortOrder('year-new')" id="sortYearNew">🚗 Año reciente</button>
                <button class="sort-btn" onclick="setSortOrder('year-old')" id="sortYearOld">🕰️ Año antiguo</button>
            </div>
        </div>
    </div>
    <div class="container">
        <!-- Sección del Catálogo -->
        <div id="catalogSection" class="page-section active">
            <div class="page-content">
                <!-- Sección de Destacados -->
                <div class="featured-section" id="featuredSection" style="display: none;">
                    <h2 class="featured-title">⭐ Vehículos Destacados</h2>
                    <p class="featured-subtitle">Los mejores vehículos seleccionados especialmente para ti</p>
                    <div class="featured-grid" id="featuredGrid">
                        <!-- Los vehículos destacados se generarán aquí -->
                    </div>
                </div>

                <!-- Sección de Publicidad -->
                <div class="advertising-section" id="advertisingSection" style="display: none;">
                    <div class="advertising-label">🎯 PUBLICIDAD</div>
                    <div class="advertising-content">
                        <img id="advertisingImage" class="advertising-image" src="" alt="Publicidad">
                        <div class="advertising-info">
                            <h3 id="advertisingTitle" class="advertising-title"></h3>
                            <p id="advertisingDescription" class="advertising-description"></p>
                            <div class="advertising-actions">
                                <a id="advertisingWhatsApp" class="advertising-btn whatsapp" href="#" target="_blank" style="display: none;">
                                    📱 WhatsApp
                                </a>
                                <a id="advertisingWebsite" class="advertising-btn website" href="#" target="_blank" style="display: none;">
                                    🌐 Sitio Web
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Catálogo Principal -->
                <div class="catalog-grid" id="catalog">
                    <!-- Los vehículos se generarán aquí -->
                </div>

                <!-- Estado vacío -->
                <div id="emptyCatalog" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">🔍</div>
                    <h3>No se encontraron vehículos</h3>
                    <p>Intenta ajustar los filtros de búsqueda o revisa más tarde.</p>
                    <button class="nav-btn" onclick="clearAllFilters()" style="margin-top: 20px;">🗑️ Limpiar Filtros</button>
                </div>
            </div>
        </div>

        <!-- Sección del Dashboard -->
        <div id="dashboardSection" class="page-section">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">📊 Mi Dashboard</h2>
                    <p class="dashboard-subtitle">Gestiona tus publicaciones de vehículos</p>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalVehicles">0</div>
                        <div class="stat-label">Vehículos Publicados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeVehicles">0</div>
                        <div class="stat-label">Publicaciones Activas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingVehicles">0</div>
                        <div class="stat-label">Pendientes Aprobación</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="soldVehicles">0</div>
                        <div class="stat-label">Vehículos Vendidos</div>
                    </div>
                </div>

                <div id="userVehiclesGrid" class="dashboard-grid">
                    <!-- Las publicaciones del usuario se generarán aquí -->
                </div>

                <div id="emptyDashboard" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">📝</div>
                    <h3>No tienes publicaciones aún</h3>
                    <p>¡Comienza publicando tu primer vehículo!</p>
                    <button class="nav-btn" onclick="handlePublishClick()" style="margin-top: 20px;">📝 Publicar Vehículo</button>
                </div>
            </div>
        </div>

        <!-- Sección del Admin -->
        <div id="adminSection" class="page-section">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">⚙️ Panel de Administración</h2>
                    <p class="dashboard-subtitle">Gestión completa del sistema</p>
                </div>

                <div class="admin-panel">
                    <div class="admin-tabs">
                        <button class="admin-tab active" onclick="showAdminTab('users')">👥 Usuarios</button>
                        <button class="admin-tab" onclick="showAdminTab('vehicles')">🚗 Vehículos</button>
                        <button class="admin-tab" onclick="showAdminTab('publications')">📋 Publicaciones</button>
                        <button class="admin-tab" onclick="showAdminTab('featured')">⭐ Destacados</button>
                        <button class="admin-tab" onclick="showAdminTab('advertising')">🎯 Publicidad</button>
                        <button class="admin-tab" onclick="showAdminTab('customization')">🎨 Personalización</button>
                        <button class="admin-tab" onclick="showAdminTab('data')">💾 Datos</button>
                    </div>

                    <!-- Gestión de Usuarios -->
                    <div id="adminUsers" class="admin-content active">
                        <h3>👥 Gestión de Usuarios</h3>
                        <p class="admin-section-description">
                            Administra los usuarios registrados en la plataforma y gestiona sus verificaciones.
                        </p>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">Usuarios Registrados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="verifiedUsers">0</div>
                                <div class="stat-label">Usuarios Verificados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="pendingUsers">0</div>
                                <div class="stat-label">Pendientes Verificación</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="rejectedUsers">0</div>
                                <div class="stat-label">Usuarios Rechazados</div>
                            </div>
                        </div>
                        <table class="data-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>👤 Usuario</th>
                                    <th>🆔 RIF</th>
                                    <th>📱 WhatsApp</th>
                                    <th>📊 Estado</th>
                                    <th>📅 Registro</th>
                                    <th>🚗 Publicaciones</th>
                                    <th>⚡ Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Gestión de Vehículos -->
                    <div id="adminVehicles" class="admin-content">
                        <h3>🚗 Gestión de Vehículos</h3>
                        <p class="admin-section-description">
                            Controla todos los vehículos publicados en la plataforma, incluyendo destacados y vendidos.
                        </p>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="adminTotalVehicles">0</div>
                                <div class="stat-label">Total Vehículos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="adminActiveVehicles">0</div>
                                <div class="stat-label">Vehículos Activos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="adminSoldVehicles">0</div>
                                <div class="stat-label">Vehículos Vendidos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="adminFeaturedVehicles">0</div>
                                <div class="stat-label">Vehículos Destacados</div>
                            </div>
                        </div>
                        <table class="data-table" id="vehiclesTable">
                            <thead>
                                <tr>
                                    <th>🚗 Vehículo</th>
                                    <th>💰 Precio</th>
                                    <th>👤 Propietario</th>
                                    <th>📊 Estado</th>
                                    <th>📅 Fecha</th>
                                    <th>⚡ Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="vehiclesTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Gestión de Publicaciones -->
                    <div id="adminPublications" class="admin-content">
                        <h3>📋 Gestión de Publicaciones</h3>
                        <p class="admin-section-description">
                            Administra las publicaciones de vehículos que requieren aprobación antes de ser visibles en el catálogo.
                        </p>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="pendingPublications">0</div>
                                <div class="stat-label">Pendientes Aprobación</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="approvedPublications">0</div>
                                <div class="stat-label">Publicaciones Aprobadas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="rejectedPublications">0</div>
                                <div class="stat-label">Publicaciones Rechazadas</div>
                            </div>
                        </div>
                        <table class="data-table" id="publicationsTable">
                            <thead>
                                <tr>
                                    <th>🚗 Vehículo</th>
                                    <th>👤 Publicado por</th>
                                    <th>📅 Fecha</th>
                                    <th>📊 Estado</th>
                                    <th>⚡ Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="publicationsTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Gestión de Destacados -->
                    <div id="adminFeatured" class="admin-content">
                        <h3>⭐ Gestión de Vehículos Destacados</h3>
                        <p class="admin-section-description">
                            Selecciona qué vehículos aparecerán en la sección destacada del catálogo para mayor visibilidad.
                        </p>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="totalFeaturedVehicles">0</div>
                                <div class="stat-label">Vehículos Destacados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="availableForFeatured">0</div>
                                <div class="stat-label">Disponibles para Destacar</div>
                            </div>
                        </div>
                        <table class="data-table" id="featuredTable">
                            <thead>
                                <tr>
                                    <th>🚗 Vehículo</th>
                                    <th>👤 Propietario</th>
                                    <th>💰 Precio</th>
                                    <th>⭐ Destacado</th>
                                    <th>⚡ Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="featuredTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Gestión de Publicidad - Nueva funcionalidad -->
                    <div id="adminAdvertising" class="admin-content">
                        <h3>🎯 Gestión de Publicidad</h3>
                        <p class="admin-section-description">
                            Configura el banner publicitario que aparece entre los vehículos destacados y el catálogo principal.
                        </p>
                        
                        <div class="advertising-management">
                            <h4 style="color: var(--primary-color); margin-bottom: 25px; font-size: 1.4rem;">📝 Configurar Publicidad</h4>
                            
                            <form class="advertising-form" onsubmit="saveAdvertising(event)">
                                <div class="form-group">
                                    <label class="form-label" for="adTitle">🏷️ Título de la publicidad:</label>
                                    <input type="text" class="form-input" id="adTitle" placeholder="Ej: ¡Servicios Automotrices Premium!" maxlength="100">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="adDescription">📝 Descripción:</label>
                                    <textarea class="form-textarea" id="adDescription" placeholder="Describe tu servicio o producto..." maxlength="300"></textarea>
                                </div>

                                <div class="advertising-form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="adWhatsApp">📱 WhatsApp (opcional):</label>
                                        <input type="tel" class="form-input" id="adWhatsApp" placeholder="Ej: +58 412 123 4567">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" for="adWebsite">🌐 Sitio Web (opcional):</label>
                                        <input type="url" class="form-input" id="adWebsite" placeholder="Ej: https://misitioweb.com">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">📸 Imagen de la publicidad:</label>
                                    <div class="advertising-image-upload" id="adImageUpload" onclick="document.getElementById('adImageInput').click()">
                                        <div class="advertising-upload-text">📷 Haz clic para seleccionar imagen</div>
                                        <div class="advertising-upload-hint">Tamaño recomendado: 400x300 px</div>
                                        <img id="adCurrentImage" class="advertising-current-image" style="display: none;">
                                    </div>
                                    <input type="file" id="adImageInput" accept="image/*" style="display: none;" onchange="handleAdImageUpload(event)">
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="form-btn">💾 Guardar Publicidad</button>
                                    <button type="button" class="form-btn secondary" onclick="clearAdvertising()">🗑️ Limpiar Publicidad</button>
                                </div>
                            </form>

                            <div class="advertising-preview" id="adPreview" style="display: none;">
                                <h4>👀 Vista Previa:</h4>
                                <div class="advertising-section">
                                    <div class="advertising-label">🎯 PUBLICIDAD</div>
                                    <div class="advertising-content">
                                        <img id="adPreviewImage" class="advertising-image" src="" alt="Vista previa">
                                        <div class="advertising-info">
                                            <h3 id="adPreviewTitle" class="advertising-title"></h3>
                                            <p id="adPreviewDescription" class="advertising-description"></p>
                                            <div class="advertising-actions">
                                                <span class="advertising-btn whatsapp" id="adPreviewWhatsApp" style="display: none;">📱 WhatsApp</span>
                                                <span class="advertising-btn website" id="adPreviewWebsite" style="display: none;">🌐 Sitio Web</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Personalización -->
                    <div id="adminCustomization" class="admin-content">
                        <h3>🎨 Personalización del Sitio</h3>
                        <p class="admin-section-description">
                            Personaliza la apariencia y configuración general de la plataforma.
                        </p>
                        <div class="customization-grid">
                            <div class="customization-section">
                                <h4>🎨 Colores del Sitio</h4>
                                <div class="color-controls">
                                    <div class="color-input-group">
                                        <input type="color" class="color-input" id="primaryColor" value="#00d4ff" onchange="updateColors()" title="Color Primario">
                                        <div>
                                            <label class="form-label">Color Primario:</label>
                                            <small style="color: var(--text-muted);">Botones principales, enlaces</small>
                                        </div>
                                    </div>
                                    <div class="color-input-group">
                                        <input type="color" class="color-input" id="secondaryColor" value="#ff6b35" onchange="updateColors()" title="Color Secundario">
                                        <div>
                                            <label class="form-label">Color Secundario:</label>
                                            <small style="color: var(--text-muted);">Acentos, alertas</small>
                                        </div>
                                    </div>
                                    <button class="form-btn secondary" onclick="resetColors()">🔄 Restablecer Colores</button>
                                </div>
                            </div>

                            <div class="customization-section">
                                <h4>🏷️ Información del Sitio</h4>
                                <div class="form-group">
                                    <label class="form-label" for="siteName">Nombre del Sitio:</label>
                                    <input type="text" class="form-input" id="siteName" placeholder="AutoVentas Premium" onchange="updateSiteName()" maxlength="50">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="logoUpload">Logo del Sitio:</label>
                                    <input type="file" class="form-input" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)">
                                    <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; display: block;">
                                        Tamaño recomendado: 100x100 px, formato PNG o JPG
                                    </small>
                                    <button class="form-btn secondary" onclick="removeLogo()" style="margin-top: 10px;">🗑️ Quitar Logo</button>
                                </div>
                            </div>

                            <div class="customization-section">
                                <h4>🎭 Estilo de Banner</h4>
                                <div class="banner-styles">
                                    <button class="banner-option active" onclick="setBannerStyle(0)" data-style="0">
                                        <div class="banner-preview" style="background: rgba(15, 15, 15, 0.95);">
                                            Clásico
                                        </div>
                                        <div class="banner-option-label">Clásico</div>
                                    </button>
                                    <button class="banner-option" onclick="setBannerStyle(1)" data-style="1">
                                        <div class="banner-preview" style="background: linear-gradient(135deg, #00d4ff, #ff6b35);">
                                            Gradiente
                                        </div>
                                        <div class="banner-option-label">Gradiente</div>
                                    </button>
                                    <button class="banner-option" onclick="setBannerStyle(2)" data-style="2">
                                        <div class="banner-preview" style="background: #1a1a1a; border-bottom: 3px solid #00d4ff;">
                                            Línea
                                        </div>
                                        <div class="banner-option-label">Línea</div>
                                    </button>
                                    <button class="banner-option" onclick="setBannerStyle(3)" data-style="3">
                                        <div class="banner-preview" style="background: linear-gradient(90deg, #0f0f0f, #00d4ff, #0f0f0f);">
                                            Destello
                                        </div>
                                        <div class="banner-option-label">Destello</div>
                                    </button>
                                    <button class="banner-option" onclick="setBannerStyle(4)" data-style="4">
                                        <div class="banner-preview" style="background: rgba(0, 0, 0, 0.9); box-shadow: 0 0 10px #00d4ff;">
                                            Neón
                                        </div>
                                        <div class="banner-option-label">Neón</div>
                                    </button>
                                    <button class="banner-option" onclick="setBannerStyle(5)" data-style="5">
                                        <div class="banner-preview" style="background: linear-gradient(45deg, #2d2d2d, #4a4a4a);">
                                            Metálico
                                        </div>
                                        <div class="banner-option-label">Metálico</div>
                                    </button>
                                </div>
                            </div>

                            <div class="customization-section">
                                <h4>📱 Redes Sociales</h4>
                                <div class="form-group">
                                    <label class="form-label" for="instagramUrl">📷 Instagram:</label>
                                    <input type="url" class="form-input" id="instagramUrl" placeholder="https://instagram.com/tu_cuenta" onchange="updateSocialLinks()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="facebookUrl">📘 Facebook:</label>
                                    <input type="url" class="form-input" id="facebookUrl" placeholder="https://facebook.com/tu_pagina" onchange="updateSocialLinks()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="tiktokUrl">🎵 TikTok:</label>
                                    <input type="url" class="form-input" id="tiktokUrl" placeholder="https://tiktok.com/@tu_usuario" onchange="updateSocialLinks()">
                                </div>
                            </div>

                            <div class="customization-section">
                                <h4>💾 Configuración</h4>
                                <button class="form-btn" onclick="saveCustomization()">💾 Guardar Configuración</button>
                                <button class="form-btn secondary" onclick="loadCustomization()">🔄 Cargar Configuración</button>
                                <button class="form-btn secondary" onclick="resetCustomization()">🗑️ Restablecer Todo</button>
                                <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; display: block;">
                                    Los cambios se aplicarán inmediatamente pero se guardarán al hacer clic en "Guardar Configuración"
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Gestión de Datos -->
                    <div id="adminData" class="admin-content">
                        <h3>💾 Gestión de Datos</h3>
                        <p class="admin-section-description">
                            Herramientas para exportar, respaldar y gestionar los datos de la plataforma.
                        </p>
                        <div class="customization-grid">
                            <div class="customization-section">
                                <h4>📤 Exportar Datos</h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <button class="form-btn" onclick="exportData('users')">📤 Exportar Usuarios</button>
                                    <button class="form-btn" onclick="exportData('vehicles')">📤 Exportar Vehículos</button>
                                    <button class="form-btn" onclick="exportData('all')">📤 Exportar Todo</button>
                                </div>
                                <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 15px; display: block;">
                                    Los datos se exportarán en formato JSON para respaldo o migración.
                                </small>
                            </div>
                            <div class="customization-section">
                                <h4>🔄 Backup Firebase</h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <button class="form-btn secondary" onclick="backupFirebaseData()">🔄 Crear Backup</button>
                                    <button class="form-btn secondary" onclick="clearFirebaseData()" style="background: rgba(220, 53, 69, 0.2); border-color: var(--error-color); color: var(--error-color);">
                                        🗑️ Limpiar Firebase
                                    </button>
                                </div>
                                <div style="background: rgba(220, 53, 69, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid var(--error-color); margin-top: 15px;">
                                    <strong style="color: var(--error-color);">⚠️ ADVERTENCIA:</strong>
                                    <p style="color: var(--text-muted); font-size: 0.9rem; margin: 5px 0 0 0; line-height: 1.4;">
                                        La limpieza de Firebase eliminará todos los datos permanentemente. Esta acción no se puede deshacer.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de Redes Sociales -->
    <div class="social-section" id="socialSection">
        <div class="social-container">
            <h3 class="social-title">Síguenos en nuestras redes sociales</h3>
            <p class="social-subtitle">Mantente al día con las últimas novedades</p>
            <div class="social-links" id="socialLinks">
                <!-- Las redes sociales se generarán aquí -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>© 2025 GStar INK - Todos los derechos reservados | AutoVentas Premium</p>
            <div class="footer-links">
                <a href="#" class="footer-link">Términos de Servicio</a>
                <a href="#" class="footer-link">Política de Privacidad</a>
                <a href="#" class="footer-link">Contacto</a>
            </div>
        </div>
    </footer>

    <!-- Modal para detalles del vehículo -->
    <div class="overlay" id="overlay">
        <div class="modal">
            <button class="close-btn" onclick="closeModal()" aria-label="Cerrar modal">&times;</button>
            <div class="image-section">
                <img id="mainImage" class="main-image" src="" alt="Vehículo">
                <button class="image-nav prev" onclick="prevImage()" aria-label="Imagen anterior">‹</button>
                <button class="image-nav next" onclick="nextImage()" aria-label="Imagen siguiente">›</button>
                <div class="thumbnails" id="thumbnails"></div>
            </div>
            <div class="details-section">
                <div id="vehicleDetails"></div>
                <div class="contact-section">
                    <button class="contact-btn" id="contactBtn" onclick="contactOwner()">
                        💬 Estoy Interesado
                    </button>
                    <p class="contact-note">Te conectaremos directamente con el vendedor via WhatsApp</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Autenticación -->
    <div class="overlay" id="authOverlay">
        <div class="auth-modal">
            <button class="close-btn" onclick="closeAuthModal()" aria-label="Cerrar modal">&times;</button>
            
            <!-- Formulario de Login -->
            <div id="loginForm">
                <h2 class="form-title">🔐 Iniciar Sesión</h2>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label class="form-label" for="loginRif">🆔 RIF:</label>
                        <input type="text" class="form-input" id="loginRif" placeholder="Ej: J-12345678-9" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">🔒 Contraseña:</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Tu contraseña" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="form-btn">🚀 Iniciar Sesión</button>
                    <button type="button" class="form-btn secondary" onclick="showRegisterForm()">
                        📝 ¿No tienes cuenta? Regístrate
                    </button>
                </form>
            </div>

            <!-- Formulario de Registro -->
            <div id="registerForm" style="display: none;">
                <h2 class="form-title">📝 Crear Cuenta</h2>
                <form onsubmit="register(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="registerName">👤 Nombre:</label>
                            <input type="text" class="form-input" id="registerName" placeholder="Tu nombre" required autocomplete="given-name">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="registerLastname">👤 Apellido:</label>
                            <input type="text" class="form-input" id="registerLastname" placeholder="Tu apellido" required autocomplete="family-name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerRif">🆔 RIF:</label>
                        <input type="text" class="form-input" id="registerRif" placeholder="Ej: J-12345678-9" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerWhatsapp">📱 WhatsApp:</label>
                        <input type="tel" class="form-input" id="registerWhatsapp" placeholder="Ej: +58 412 123 4567" required autocomplete="tel">
                        <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 8px; display: block;">
                            📋 Tu cuenta será verificada por un administrador antes de poder publicar
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">🔒 Contraseña:</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="Mínimo 6 caracteres" required autocomplete="new-password">
                    </div>
                    <button type="submit" class="form-btn">✨ Crear Cuenta</button>
                    <button type="button" class="form-btn secondary" onclick="showLoginForm()">
                        🔑 ¿Ya tienes cuenta? Inicia sesión
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Verificación de Usuario -->
    <div class="overlay" id="verificationOverlay">
        <div class="verification-modal">
            <button class="close-btn" onclick="closeVerificationModal()" aria-label="Cerrar modal">&times;</button>
            <h2 class="form-title">✅ Verificación de Usuario</h2>
            
            <div id="userVerificationInfo" class="verification-info">
                <!-- Info del usuario se llenará aquí -->
            </div>

            <div class="verification-actions">
                <div class="form-group">
                    <label class="form-label" for="verificationMessage">💬 Mensaje personalizado (opcional):</label>
                    <textarea class="form-textarea" id="verificationMessage" placeholder="Mensaje adicional para el usuario..." maxlength="500"></textarea>
                </div>

                <div class="verification-buttons">
                    <button class="form-btn btn-approve" onclick="approveUser()">
                        ✅ Verificar Usuario
                    </button>
                    <button class="form-btn btn-reject" onclick="rejectUser()">
                        ❌ Rechazar Usuario
                    </button>
                </div>
                <button class="form-btn secondary" onclick="closeVerificationModal()">
                    🚫 Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Verificación de Publicaciones -->
    <div class="overlay" id="publicationVerificationOverlay">
        <div class="verification-modal">
            <button class="close-btn" onclick="closePublicationVerificationModal()" aria-label="Cerrar modal">&times;</button>
            <h2 class="form-title">📋 Verificación de Publicación</h2>
            
            <div id="publicationVerificationInfo" class="verification-info">
                <!-- Info de la publicación se llenará aquí -->
            </div>

            <div class="verification-actions">
                <div class="form-group">
                    <label class="form-label" for="publicationVerificationMessage">💬 Mensaje para el propietario (opcional):</label>
                    <textarea class="form-textarea" id="publicationVerificationMessage" placeholder="Mensaje adicional sobre la decisión..." maxlength="500"></textarea>
                </div>

                <div class="verification-buttons">
                    <button class="form-btn btn-approve" onclick="approvePublication()">
                        ✅ Aprobar Publicación
                    </button>
                    <button class="form-btn btn-reject" onclick="rejectPublication()">
                        ❌ Rechazar Publicación
                    </button>
                </div>
                <button class="form-btn secondary" onclick="closePublicationVerificationModal()">
                    🚫 Cancelar
                </button>
            </div>
        </div>
    </div>
    <!-- Modal de Publicación -->
    <div class="overlay" id="publishOverlay">
        <div class="publish-modal">
            <button class="close-btn" onclick="closePublishModal()" aria-label="Cerrar modal">&times;</button>
            <h2 class="form-title">🚗 Publicar Vehículo</h2>
            
            <div class="publication-status pending" id="publicationNotice">
                ⏳ Tu publicación será revisada por un administrador antes de aparecer en el catálogo
            </div>
            
            <form onsubmit="publishVehicle(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleYear">📅 Año:</label>
                        <input type="number" class="form-input" id="vehicleYear" min="1990" max="2025" placeholder="2020" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleBrand">🏭 Marca:</label>
                        <input type="text" class="form-input" id="vehicleBrand" placeholder="Toyota" required maxlength="50">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="vehicleModel">🚗 Modelo:</label>
                    <input type="text" class="form-input" id="vehicleModel" placeholder="Corolla" required maxlength="50">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="vehiclePrice">💰 Precio:</label>
                    <input type="text" class="form-input" id="vehiclePrice" placeholder="$15.500" required maxlength="20">
                </div>

                <div class="separator"></div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleTransmission">🏁 Transmisión:</label>
                        <select class="form-input" id="vehicleTransmission" required>
                            <option value="">Seleccionar</option>
                            <option value="manual">Manual</option>
                            <option value="automático">Automático</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleAC">❄️ A/A:</label>
                        <select class="form-input" id="vehicleAC" required>
                            <option value="">Seleccionar</option>
                            <option value="si">Sí</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleRadio">🎛 Radio:</label>
                        <select class="form-input" id="vehicleRadio" required>
                            <option value="">Seleccionar</option>
                            <option value="si">Sí</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleMileage">🛣️ Recorrido (KM):</label>
                        <input type="text" class="form-input" id="vehicleMileage" placeholder="85.000 KM" required maxlength="20">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleColor">🎨 Color:</label>
                        <input type="text" class="form-input" id="vehicleColor" placeholder="Blanco" required maxlength="30">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleOwners">🪪 Dueños:</label>
                        <input type="text" class="form-input" id="vehicleOwners" placeholder="1" required maxlength="10">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleKeys">🔑 Llaves:</label>
                        <input type="number" class="form-input" id="vehicleKeys" min="1" max="10" placeholder="2" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleTires">🛞 Cauchos (% vida):</label>
                        <input type="text" class="form-input" id="vehicleTires" placeholder="90% de vida" required maxlength="30">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="vehicleLocation">🌎 Ubicación:</label>
                    <input type="text" class="form-input" id="vehicleLocation" placeholder="Caracas" required maxlength="50">
                </div>

                <div class="form-group">
                    <label class="form-label" for="vehicleExtras">⚙️ Extras:</label>
                    <input type="text" class="form-input" id="vehicleExtras" placeholder="Cámara reversa, sensores" maxlength="200">
                </div>

                <div class="form-group">
                    <label class="form-label" for="vehicleNotes">📝 Notas adicionales:</label>
                    <textarea class="form-textarea" id="vehicleNotes" placeholder="Detalles importantes del vehículo..." maxlength="500"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">📸 Imágenes del vehículo:</label>
                    <div class="image-upload-area" onclick="document.getElementById('imageInput').click()">
                        <p class="image-upload-text">📷 Haz clic para seleccionar imágenes</p>
                        <p class="image-upload-hint">Máximo 10 imágenes • Formatos: JPG, PNG • Tamaño máximo: 5MB por imagen</p>
                    </div>
                    <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    <div id="imagePreviewGrid" class="image-preview-grid"></div>
                </div>

                <button type="submit" class="form-btn" id="publishSubmitBtn">🚗 Publicar Vehículo</button>
                <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; display: block; text-align: center;">
                    Al publicar, aceptas que la información proporcionada es veraz y completa.
                </small>
            </form>
        </div>
    </div>

    <!-- Modal de Edición -->
    <div class="overlay" id="editOverlay">
        <div class="edit-modal">
            <button class="close-btn" onclick="closeEditModal()" aria-label="Cerrar modal">&times;</button>
            <h2 class="form-title">✏️ Editar Vehículo</h2>
            
            <form onsubmit="updateVehicle(event)">
                <input type="hidden" id="editVehicleId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editVehicleYear">📅 Año:</label>
                        <input type="number" class="form-input" id="editVehicleYear" min="1990" max="2025" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editVehicleBrand">🏭 Marca:</label>
                        <input type="text" class="form-input" id="editVehicleBrand" required maxlength="50">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="editVehicleModel">🚗 Modelo:</label>
                    <input type="text" class="form-input" id="editVehicleModel" required maxlength="50">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="editVehiclePrice">💰 Precio:</label>
                    <input type="text" class="form-input" id="editVehiclePrice" required maxlength="20">
                </div>

                <div class="separator"></div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editVehicleTransmission">🏁 Transmisión:</label>
                        <select class="form-input" id="editVehicleTransmission" required>
                            <option value="">Seleccionar</option>
                            <option value="manual">Manual</option>
                            <option value="automático">Automático</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editVehicleAC">❄️ A/A:</label>
                        <select class="form-input" id="editVehicleAC" required>
                            <option value="">Seleccionar</option>
                            <option value="si">Sí</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editVehicleRadio">🎛 Radio:</label>
                        <select class="form-input" id="editVehicleRadio" required>
                            <option value="">Seleccionar</option>
                            <option value="si">Sí</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editVehicleMileage">🛣️ Recorrido (KM):</label>
                        <input type="text" class="form-input" id="editVehicleMileage" required maxlength="20">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editVehicleColor">🎨 Color:</label>
                        <input type="text" class="form-input" id="editVehicleColor" required maxlength="30">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editVehicleOwners">🪪 Dueños:</label>
                        <input type="text" class="form-input" id="editVehicleOwners" required maxlength="10">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editVehicleKeys">🔑 Llaves:</label>
                        <input type="number" class="form-input" id="editVehicleKeys" min="1" max="10" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editVehicleTires">🛞 Cauchos (% vida):</label>
                        <input type="text" class="form-input" id="editVehicleTires" required maxlength="30">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editVehicleLocation">🌎 Ubicación:</label>
                    <input type="text" class="form-input" id="editVehicleLocation" required maxlength="50">
                </div>

                <div class="form-group">
                    <label class="form-label" for="editVehicleExtras">⚙️ Extras:</label>
                    <input type="text" class="form-input" id="editVehicleExtras" maxlength="200">
                </div>

                <div class="form-group">
                    <label class="form-label" for="editVehicleNotes">📝 Notas adicionales:</label>
                    <textarea class="form-textarea" id="editVehicleNotes" maxlength="500"></textarea>
                </div>

                <button type="submit" class="form-btn" id="editSubmitBtn">✏️ Actualizar Vehículo</button>
                <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; display: block; text-align: center;">
                    Los cambios serán guardados inmediatamente.
                </small>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let currentVehicle = null;
        let currentImageIndex = 0;
        let currentUser = null;
        let uploadedImages = [];
        let currentSection = 'catalog';
        let currentUserToVerify = null;
        let currentPublicationToVerify = null;
        let vehicles = [];
        let users = [];
        let searchPanelOpen = false;
        let currentFilters = {
            search: '',
            brand: '',
            model: '',
            year: '',
            price: '',
            sort: 'newest'
        };

        // Usuario administrador por defecto
        const adminUser = {
            id: "ADMIN",
            name: "Administrador",
            lastname: "Sistema",
            rif: "ADMIN",
            whatsapp: "+58 000 000 0000",
            password: "admin123",
            isAdmin: true,
            verified: true,
            verificationStatus: 'verified'
        };

        // Configuración del sitio
        let siteConfig = {
            siteName: "AutoVentas Premium",
            primaryColor: "#00d4ff",
            secondaryColor: "#ff6b35",
            logoUrl: "",
            bannerStyle: 0,
            socialLinks: {
                instagram: "",
                facebook: "",
                tiktok: ""
            },
            advertising: {
                enabled: false,
                title: "",
                description: "",
                imageUrl: "",
                whatsapp: "",
                website: ""
            }
        };

        // API Key de ImgBB para subida de imágenes
        const IMGBB_API_KEY = "176862903123d1f89cd3223a4d330174";

        // Funciones de utilidad
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            // Remover notificación existente si la hay
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'polite');
            document.body.appendChild(notification);

            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);

            // Permitir cerrar manualmente
            notification.addEventListener('click', () => {
                notification.remove();
            });
        }

        // Sistema de toggle para panel de búsqueda
        function toggleSearchPanel() {
            const panel = document.getElementById('searchFilterSection');
            const toggleBtn = document.getElementById('searchToggleBtn');
            
            searchPanelOpen = !searchPanelOpen;
            
            if (searchPanelOpen) {
                panel.classList.add('active');
                toggleBtn.classList.add('active');
                toggleBtn.innerHTML = '✕';
                toggleBtn.setAttribute('aria-label', 'Cerrar panel de búsqueda');
                document.body.style.paddingTop = '0';
            } else {
                panel.classList.remove('active');
                toggleBtn.classList.remove('active');
                toggleBtn.innerHTML = '🔍';
                toggleBtn.setAttribute('aria-label', 'Abrir panel de búsqueda');
                document.body.style.paddingTop = '0';
            }
        }

        // Función para mostrar/ocultar botón de búsqueda según la sección
        function updateSearchButtonVisibility() {
            const searchBtn = document.getElementById('searchToggleBtn');
            
            if (currentSection === 'catalog') {
                searchBtn.style.display = 'flex';
            } else {
                searchBtn.style.display = 'none';
                // Cerrar panel si está abierto al cambiar de sección
                if (searchPanelOpen) {
                    toggleSearchPanel();
                }
            }
        }

        // Funciones Firebase para vehículos
        async function loadVehiclesFromFirebase() {
            try {
                showLoading();
                const { collection, getDocs, query, orderBy } = window.firebaseModules;
                const vehiclesRef = collection(window.db, 'vehicles');
                const q = query(vehiclesRef, orderBy('publishDate', 'desc'));
                const querySnapshot = await getDocs(q);
                
                vehicles = [];
                querySnapshot.forEach((doc) => {
                    vehicles.push({ id: doc.id, ...doc.data() });
                });
                
                updateFilterOptions();
                renderCatalog();
                hideLoading();
                console.log('✅ Vehículos cargados:', vehicles.length);
            } catch (error) {
                console.error('❌ Error loading vehicles:', error);
                hideLoading();
                showNotification('Error al cargar vehículos. Verifica tu conexión.', 'error');
            }
        }

        async function saveVehicleToFirebase(vehicleData) {
            try {
                showLoading();
                const { collection, addDoc } = window.firebaseModules;
                const docRef = await addDoc(collection(window.db, 'vehicles'), vehicleData);
                
                vehicleData.id = docRef.id;
                vehicles.push(vehicleData);
                
                updateFilterOptions();
                hideLoading();
                showNotification('Vehículo publicado exitosamente. Será revisado por un administrador.', 'success');
                console.log('✅ Vehículo guardado:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('❌ Error saving vehicle:', error);
                hideLoading();
                showNotification('Error al publicar vehículo. Intenta nuevamente.', 'error');
                throw error;
            }
        }

        async function updateVehicleInFirebase(vehicleId, updatedData) {
            try {
                showLoading();
                const { doc, updateDoc } = window.firebaseModules;
                const vehicleRef = doc(window.db, 'vehicles', vehicleId);
                await updateDoc(vehicleRef, updatedData);
                
                const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
                if (vehicleIndex !== -1) {
                    vehicles[vehicleIndex] = { ...vehicles[vehicleIndex], ...updatedData };
                }
                
                updateFilterOptions();
                hideLoading();
                showNotification('Vehículo actualizado exitosamente', 'success');
                console.log('✅ Vehículo actualizado:', vehicleId);
            } catch (error) {
                console.error('❌ Error updating vehicle:', error);
                hideLoading();
                showNotification('Error al actualizar vehículo', 'error');
                throw error;
            }
        }

        async function deleteVehicleFromFirebase(vehicleId) {
            try {
                showLoading();
                const { doc, deleteDoc } = window.firebaseModules;
                await deleteDoc(doc(window.db, 'vehicles', vehicleId));
                
                vehicles = vehicles.filter(v => v.id !== vehicleId);
                
                updateFilterOptions();
                hideLoading();
                showNotification('Vehículo eliminado exitosamente', 'success');
                console.log('✅ Vehículo eliminado:', vehicleId);
            } catch (error) {
                console.error('❌ Error deleting vehicle:', error);
                hideLoading();
                showNotification('Error al eliminar vehículo', 'error');
                throw error;
            }
        }
        // Funciones Firebase para usuarios
        async function loadUsersFromFirebase() {
            try {
                const { collection, getDocs, query, orderBy } = window.firebaseModules;
                const usersRef = collection(window.db, 'users');
                const q = query(usersRef, orderBy('registrationDate', 'desc'));
                const querySnapshot = await getDocs(q);
                
                users = [];
                querySnapshot.forEach((doc) => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('✅ Usuarios cargados:', users.length);
            } catch (error) {
                console.error('❌ Error loading users:', error);
                showNotification('Error al cargar usuarios', 'error');
            }
        }

        async function saveUserToFirebase(userData) {
            try {
                showLoading();
                const { collection, addDoc } = window.firebaseModules;
                const docRef = await addDoc(collection(window.db, 'users'), userData);
                
                userData.id = docRef.id;
                users.push(userData);
                
                hideLoading();
                showNotification('Usuario registrado exitosamente', 'success');
                console.log('✅ Usuario guardado:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('❌ Error saving user:', error);
                hideLoading();
                showNotification('Error al registrar usuario', 'error');
                throw error;
            }
        }

        async function updateUserInFirebase(userId, updatedData) {
            try {
                showLoading();
                const { doc, updateDoc } = window.firebaseModules;
                const userRef = doc(window.db, 'users', userId);
                await updateDoc(userRef, updatedData);
                
                const userIndex = users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    users[userIndex] = { ...users[userIndex], ...updatedData };
                }
                
                hideLoading();
                showNotification('Usuario actualizado exitosamente', 'success');
                console.log('✅ Usuario actualizado:', userId);
            } catch (error) {
                console.error('❌ Error updating user:', error);
                hideLoading();
                showNotification('Error al actualizar usuario', 'error');
                throw error;
            }
        }

        async function deleteUserFromFirebase(userId) {
            try {
                showLoading();
                const { doc, deleteDoc } = window.firebaseModules;
                await deleteDoc(doc(window.db, 'users', userId));
                
                users = users.filter(u => u.id !== userId);
                
                hideLoading();
                showNotification('Usuario eliminado exitosamente', 'success');
                console.log('✅ Usuario eliminado:', userId);
            } catch (error) {
                console.error('❌ Error deleting user:', error);
                hideLoading();
                showNotification('Error al eliminar usuario', 'error');
                throw error;
            }
        }

        // Funciones Firebase para configuración
        async function loadConfigFromFirebase() {
            try {
                const { collection, getDocs } = window.firebaseModules;
                const configRef = collection(window.db, 'config');
                const querySnapshot = await getDocs(configRef);
                
                querySnapshot.forEach((doc) => {
                    if (doc.id === 'siteConfig') {
                        siteConfig = { ...siteConfig, ...doc.data() };
                    }
                });
                
                applySiteConfig();
                console.log('✅ Configuración cargada');
            } catch (error) {
                console.error('❌ Error loading config:', error);
            }
        }

        async function saveConfigToFirebase() {
            try {
                const { doc, setDoc } = window.firebaseModules;
                await setDoc(doc(window.db, 'config', 'siteConfig'), siteConfig);
                showNotification('Configuración guardada exitosamente', 'success');
                console.log('✅ Configuración guardada');
            } catch (error) {
                console.error('❌ Error saving config:', error);
                showNotification('Error al guardar configuración', 'error');
            }
        }

        // Funciones para subida de imágenes con ImgBB
        async function uploadImageToFirebase(file) {
            try {
                // Validar tamaño del archivo (máximo 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    throw new Error('El archivo es demasiado grande. Máximo 5MB.');
                }

                // Validar tipo de archivo
                if (!file.type.startsWith('image/')) {
                    throw new Error('Solo se permiten archivos de imagen.');
                }

                showLoading();
                
                // Convertir archivo a base64
                const base64 = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
                
                // Preparar datos para ImgBB
                const formData = new FormData();
                formData.append('image', base64.split(',')[1]); // Solo la parte base64
                
                // Subir a ImgBB
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    hideLoading();
                    console.log('✅ Imagen subida exitosamente:', data.data.url);
                    return data.data.url; // URL directa de la imagen
                } else {
                    throw new Error(data.error ? data.error.message : 'Error al subir imagen');
                }
            } catch (error) {
                hideLoading();
                console.error('❌ Error uploading image to ImgBB:', error);
                throw error;
            }
        }

        async function uploadLogoToFirebase(file) {
            try {
                // Validar archivo
                if (file.size > 2 * 1024 * 1024) {
                    throw new Error('El logo es demasiado grande. Máximo 2MB.');
                }

                if (!file.type.startsWith('image/')) {
                    throw new Error('Solo se permiten archivos de imagen para el logo.');
                }

                showLoading();
                
                // Convertir archivo a base64
                const base64 = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
                
                // Preparar datos para ImgBB
                const formData = new FormData();
                formData.append('image', base64.split(',')[1]);
                
                // Subir a ImgBB
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    hideLoading();
                    console.log('✅ Logo subido exitosamente:', data.data.url);
                    return data.data.url;
                } else {
                    throw new Error(data.error ? data.error.message : 'Error al subir logo');
                }
            } catch (error) {
                hideLoading();
                console.error('❌ Error uploading logo to ImgBB:', error);
                throw error;
            }
        }

        // Sistema de navegación mejorado
        function showSection(section) {
            // Remover clase active de todas las secciones
            document.querySelectorAll('.page-section').forEach(sec => {
                sec.classList.remove('active');
            });

            // Mostrar sección seleccionada
            document.getElementById(section + 'Section').classList.add('active');
            currentSection = section;

            // Actualizar estado de botones de navegación
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('secondary');
            });

            const activeBtn = document.getElementById(section + 'Btn');
            if (activeBtn && section !== 'catalog') {
                activeBtn.classList.add('secondary');
            }

            // Actualizar visibilidad del botón de búsqueda
            updateSearchButtonVisibility();

            // Cargar datos específicos de la sección
            if (section === 'dashboard') {
                loadUserDashboard();
            } else if (section === 'admin') {
                loadAdminPanel();
            } else if (section === 'catalog') {
                renderCatalog();
            }

            // Scroll al top suavemente
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Sistema de autenticación mejorado
        function isLoggedIn() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    updateUserInterface();
                    return true;
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    localStorage.removeItem('currentUser');
                    return false;
                }
            }
            return false;
        }

        function updateUserInterface() {
            const userWelcome = document.getElementById('userWelcome');
            const logoutBtn = document.getElementById('logoutBtn');
            const dashboardBtn = document.getElementById('dashboardBtn');
            const adminBtn = document.getElementById('adminBtn');

            if (currentUser) {
                userWelcome.style.display = 'block';
                userWelcome.textContent = `¡Hola, ${currentUser.name}!`;
                logoutBtn.style.display = 'block';
                dashboardBtn.style.display = 'inline-block';
                
                if (currentUser.isAdmin) {
                    adminBtn.style.display = 'inline-block';
                }
            } else {
                userWelcome.style.display = 'none';
                logoutBtn.style.display = 'none';
                dashboardBtn.style.display = 'none';
                adminBtn.style.display = 'none';
            }
        }

        function handlePublishClick() {
            if (isLoggedIn()) {
                if (currentUser.verificationStatus !== 'verified' && !currentUser.isAdmin) {
                    showNotification('Tu cuenta debe estar verificada para poder publicar vehículos. Contacta al administrador.', 'warning');
                    return;
                }
                openPublishModal();
            } else {
                openAuthModal();
            }
        }

        // Funciones de autenticación
        function openAuthModal() {
            document.getElementById('authOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            showLoginForm();
        }

        function closeAuthModal() {
            document.getElementById('authOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Limpiar formularios
            document.getElementById('loginForm').reset?.();
            document.getElementById('registerForm').reset?.();
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            // Focus en el primer campo
            setTimeout(() => {
                document.getElementById('loginRif')?.focus();
            }, 100);
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            // Focus en el primer campo
            setTimeout(() => {
                document.getElementById('registerName')?.focus();
            }, 100);
        }

        async function login(event) {
            event.preventDefault();
            
            const rif = document.getElementById('loginRif').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!rif || !password) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            // Verificar admin primero
            if (rif === adminUser.rif && password === adminUser.password) {
                currentUser = adminUser;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInterface();
                closeAuthModal();
                showNotification(`¡Bienvenido ${currentUser.name}! Panel de administración activado.`, 'success');
                return;
            }
            
            // Buscar usuario en la base de datos
            const user = users.find(u => u.rif === rif && u.password === password);
            
            if (user) {
                if (user.verificationStatus === 'pending') {
                    showNotification('Tu cuenta está pendiente de verificación por un administrador. Por favor espera a que sea procesada.', 'warning');
                    return;
                } else if (user.verificationStatus === 'rejected') {
                    showNotification('Tu cuenta ha sido rechazada. Contacta al administrador para más información.', 'error');
                    return;
                }
                
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUserInterface();
                closeAuthModal();
                showNotification(`¡Bienvenido ${user.name}! Ahora puedes publicar vehículos.`, 'success');
            } else {
                showNotification('RIF o contraseña incorrectos', 'error');
            }
        }

        async function register(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const lastname = document.getElementById('registerLastname').value.trim();
            const rif = document.getElementById('registerRif').value.trim();
            const whatsapp = document.getElementById('registerWhatsapp').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            // Validaciones
            if (!name || !lastname || !rif || !whatsapp || !password) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            if (rif === adminUser.rif) {
                showNotification('Este RIF está reservado para el sistema', 'error');
                return;
            }
            
            if (users.find(u => u.rif === rif)) {
                showNotification('Ya existe una cuenta con este RIF', 'error');
                return;
            }
            
            // Validar formato de WhatsApp básico
            if (!whatsapp.match(/^\+?[\d\s\-\(\)]{10,}$/)) {
                showNotification('Por favor ingresa un número de WhatsApp válido', 'error');
                return;
            }
            
            const newUser = {
                name,
                lastname,
                rif,
                whatsapp,
                password,
                isAdmin: false,
                verified: false,
                verificationStatus: 'pending',
                registrationDate: new Date().toISOString(),
                verificationMessage: ''
            };
            
            try {
                await saveUserToFirebase(newUser);
                closeAuthModal();
                showNotification(`¡Cuenta creada exitosamente, ${name}!\n\nTu cuenta está pendiente de verificación por un administrador. Recibirás una notificación via WhatsApp cuando sea procesada.`, 'success');
            } catch (error) {
                showNotification('Error al crear la cuenta. Intenta nuevamente.', 'error');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUserInterface();
            showSection('catalog');
            showNotification('Has cerrado sesión correctamente', 'info');
        }
        // Sistema de búsqueda y filtros mejorado
        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            currentFilters.search = searchTerm;
            applyFilters();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentFilters.search = '';
            applyFilters();
        }

        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('yearFilter').value = '';
            document.getElementById('priceFilter').value = '';
            
            currentFilters = {
                search: '',
                brand: '',
                model: '',
                year: '',
                price: '',
                sort: 'newest'
            };
            
            setSortOrder('newest');
            applyFilters();
            showNotification('Filtros limpiados', 'info');
        }

        function applyFilters() {
            currentFilters.brand = document.getElementById('brandFilter').value;
            currentFilters.model = document.getElementById('modelFilter').value;
            currentFilters.year = document.getElementById('yearFilter').value;
            currentFilters.price = document.getElementById('priceFilter').value;
            
            renderCatalog();
        }

        function setSortOrder(order) {
            currentFilters.sort = order;
            
            // Actualizar estado de botones de ordenamiento
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            
            const orderMap = {
                'newest': 'sortNewest',
                'oldest': 'sortOldest',
                'price-low': 'sortPriceLow',
                'price-high': 'sortPriceHigh',
                'year-new': 'sortYearNew',
                'year-old': 'sortYearOld'
            };
            
            const activeBtn = document.getElementById(orderMap[order]);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            renderCatalog();
        }

        function updateFilterOptions() {
            // Extraer opciones únicas de vehículos aprobados
            const approvedVehicles = vehicles.filter(v => v.publicationStatus === 'approved');
            
            const brands = [...new Set(approvedVehicles.map(v => v.brand))].sort();
            const models = [...new Set(approvedVehicles.map(v => v.model))].sort();
            const years = [...new Set(approvedVehicles.map(v => v.year))].sort((a, b) => b - a);
            
            updateSelectOptions('brandFilter', brands);
            updateSelectOptions('modelFilter', models);
            updateSelectOptions('yearFilter', years);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            
            // Mantener la primera opción (placeholder)
            const firstOption = select.options[0];
            select.innerHTML = '';
            select.appendChild(firstOption);
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
            
            // Restaurar valor seleccionado si aún existe
            if (options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        function filterVehicles(vehiclesList) {
            let filtered = vehiclesList.filter(vehicle => {
                // Solo mostrar vehículos aprobados en el catálogo público
                if (!vehicle.publicationStatus || vehicle.publicationStatus !== 'approved') {
                    return false;
                }
                
                const matchesSearch = !currentFilters.search || 
                    vehicle.brand.toLowerCase().includes(currentFilters.search) ||
                    vehicle.model.toLowerCase().includes(currentFilters.search) ||
                    vehicle.year.toString().includes(currentFilters.search) ||
                    vehicle.color?.toLowerCase().includes(currentFilters.search) ||
                    vehicle.location?.toLowerCase().includes(currentFilters.search);
                
                const matchesBrand = !currentFilters.brand || vehicle.brand === currentFilters.brand;
                const matchesModel = !currentFilters.model || vehicle.model === currentFilters.model;
                const matchesYear = !currentFilters.year || vehicle.year.toString() === currentFilters.year;
                
                let matchesPrice = true;
                if (currentFilters.price) {
                    const vehiclePrice = parseFloat(vehicle.price.replace(/[^0-9.-]+/g, ""));
                    const maxPrice = parseFloat(currentFilters.price);
                    matchesPrice = vehiclePrice <= maxPrice;
                }
                
                return matchesSearch && matchesBrand && matchesModel && matchesYear && matchesPrice;
            });
            
            return sortVehicles(filtered);
        }

        function sortVehicles(vehiclesList) {
            return vehiclesList.sort((a, b) => {
                switch (currentFilters.sort) {
                    case 'newest':
                        return new Date(b.publishDate) - new Date(a.publishDate);
                    case 'oldest':
                        return new Date(a.publishDate) - new Date(b.publishDate);
                    case 'price-low':
                        return parseFloat(a.price.replace(/[^0-9.-]+/g, "")) - parseFloat(b.price.replace(/[^0-9.-]+/g, ""));
                    case 'price-high':
                        return parseFloat(b.price.replace(/[^0-9.-]+/g, "")) - parseFloat(a.price.replace(/[^0-9.-]+/g, ""));
                    case 'year-new':
                        return b.year - a.year;
                    case 'year-old':
                        return a.year - b.year;
                    default:
                        return 0;
                }
            });
        }

        // Funciones del catálogo mejoradas
        function renderCatalog() {
            const catalog = document.getElementById('catalog');
            const featuredSection = document.getElementById('featuredSection');
            const featuredGrid = document.getElementById('featuredGrid');
            const advertisingSection = document.getElementById('advertisingSection');
            const emptyCatalog = document.getElementById('emptyCatalog');
            
            const filteredVehicles = filterVehicles(vehicles);
            const featuredVehicles = filteredVehicles.filter(v => v.featured && !v.sold);
            const regularVehicles = filteredVehicles.filter(v => !v.featured);
            
            // Renderizar destacados
            if (featuredVehicles.length > 0) {
                featuredSection.style.display = 'block';
                featuredGrid.innerHTML = '';
                featuredVehicles.forEach(vehicle => {
                    featuredGrid.appendChild(createVehicleCard(vehicle, true));
                });
            } else {
                featuredSection.style.display = 'none';
            }
            
            // Renderizar publicidad (solo si está habilitada y configurada)
            if (siteConfig.advertising?.enabled && siteConfig.advertising?.title && siteConfig.advertising?.imageUrl) {
                renderAdvertising();
                advertisingSection.style.display = 'block';
            } else {
                advertisingSection.style.display = 'none';
            }
            
            // Renderizar catálogo regular
            catalog.innerHTML = '';
            if (regularVehicles.length > 0) {
                regularVehicles.forEach(vehicle => {
                    catalog.appendChild(createVehicleCard(vehicle, false));
                });
                emptyCatalog.style.display = 'none';
            } else if (featuredVehicles.length === 0) {
                // Solo mostrar estado vacío si no hay vehículos destacados tampoco
                emptyCatalog.style.display = 'block';
            } else {
                emptyCatalog.style.display = 'none';
            }
            
            // Actualizar contador de resultados
            updateResultsCounter(filteredVehicles.length);
        }

        function updateResultsCounter(count) {
            // Agregar contador de resultados si no existe
            let counter = document.getElementById('resultsCounter');
            if (!counter) {
                counter = document.createElement('div');
                counter.id = 'resultsCounter';
                counter.style.cssText = `
                    text-align: center;
                    color: var(--text-muted);
                    font-size: 1rem;
                    margin: 20px 0;
                    font-weight: 600;
                `;
                
                const catalogSection = document.getElementById('catalogSection');
                const pageContent = catalogSection.querySelector('.page-content');
                pageContent.insertBefore(counter, pageContent.firstChild);
            }
            
            if (count === 0) {
                counter.textContent = 'No se encontraron vehículos con los filtros aplicados';
            } else if (count === 1) {
                counter.textContent = '1 vehículo encontrado';
            } else {
                counter.textContent = `${count} vehículos encontrados`;
            }
        }

        function renderAdvertising() {
            const ad = siteConfig.advertising;
            
            document.getElementById('advertisingImage').src = ad.imageUrl;
            document.getElementById('advertisingTitle').textContent = ad.title;
            document.getElementById('advertisingDescription').textContent = ad.description;
            
            const whatsappBtn = document.getElementById('advertisingWhatsApp');
            const websiteBtn = document.getElementById('advertisingWebsite');
            
            if (ad.whatsapp) {
                whatsappBtn.href = `https://wa.me/${ad.whatsapp.replace(/\D/g, '')}`;
                whatsappBtn.style.display = 'inline-flex';
            } else {
                whatsappBtn.style.display = 'none';
            }
            
            if (ad.website) {
                websiteBtn.href = ad.website;
                websiteBtn.style.display = 'inline-flex';
            } else {
                websiteBtn.style.display = 'none';
            }
        }

        function createVehicleCard(vehicle, isFeatured = false) {
            const card = document.createElement('div');
            card.className = `vehicle-card ${vehicle.sold ? 'sold' : ''} ${isFeatured ? 'featured' : ''}`;
            card.onclick = () => openModal(vehicle);
            card.setAttribute('tabindex', '0');
            card.setAttribute('role', 'button');
            card.setAttribute('aria-label', `Ver detalles de ${vehicle.year} ${vehicle.brand} ${vehicle.model}`);
            
            // Manejar Enter y Space para accesibilidad
            card.onkeydown = (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openModal(vehicle);
                }
            };

            card.innerHTML = `
                <div class="vehicle-image-container">
                    <img src="${vehicle.images[0]}" alt="${vehicle.brand} ${vehicle.model}" class="vehicle-image" loading="lazy">
                    ${vehicle.sold ? '<div class="sold-badge">VENDIDO</div>' : ''}
                </div>
                <div class="vehicle-info">
                    <div class="vehicle-year-brand">${vehicle.year} | ${vehicle.brand}</div>
                    <div class="vehicle-model">${vehicle.model}</div>
                    <div class="vehicle-price">${vehicle.price}</div>
                    <div class="vehicle-location">📍 ${vehicle.location}</div>
                    <div class="vehicle-specs">
                        <div class="vehicle-spec">
                            <div class="vehicle-spec-value">${vehicle.transmission}</div>
                            <div>Transmisión</div>
                        </div>
                        <div class="vehicle-spec">
                            <div class="vehicle-spec-value">${vehicle.mileage}</div>
                            <div>Recorrido</div>
                        </div>
                        <div class="vehicle-spec">
                            <div class="vehicle-spec-value">${vehicle.year}</div>
                            <div>Año</div>
                        </div>
                    </div>
                </div>
            `;

            return card;
        }

        function openModal(vehicle) {
            currentVehicle = vehicle;
            currentImageIndex = 0;
            
            document.getElementById('overlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            updateMainImage();
            renderThumbnails();
            renderDetails();
            
            // Focus en el modal para accesibilidad
            setTimeout(() => {
                document.querySelector('.modal')?.focus();
            }, 100);
        }

        function closeModal() {
            document.getElementById('overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentVehicle = null;
        }

        function updateMainImage() {
            if (currentVehicle && currentVehicle.images && currentVehicle.images.length > 0) {
                const mainImage = document.getElementById('mainImage');
                mainImage.src = currentVehicle.images[currentImageIndex];
                mainImage.alt = `${currentVehicle.brand} ${currentVehicle.model} - Imagen ${currentImageIndex + 1}`;
                
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === currentImageIndex);
                });
            }
        }

        function renderThumbnails() {
            const container = document.getElementById('thumbnails');
            container.innerHTML = '';
            
            if (currentVehicle && currentVehicle.images) {
                currentVehicle.images.forEach((image, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = image;
                    thumb.className = 'thumbnail';
                    thumb.alt = `Miniatura ${index + 1}`;
                    thumb.setAttribute('tabindex', '0');
                    thumb.onclick = () => {
                        currentImageIndex = index;
                        updateMainImage();
                    };
                    thumb.onkeydown = (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            currentImageIndex = index;
                            updateMainImage();
                        }
                    };
                    container.appendChild(thumb);
                });
            }
        }

        function prevImage() {
            if (currentVehicle && currentVehicle.images) {
                currentImageIndex = (currentImageIndex - 1 + currentVehicle.images.length) % currentVehicle.images.length;
                updateMainImage();
            }
        }

        function nextImage() {
            if (currentVehicle && currentVehicle.images) {
                currentImageIndex = (currentImageIndex + 1) % currentVehicle.images.length;
                updateMainImage();
            }
        }

        function renderDetails() {
            const container = document.getElementById('vehicleDetails');
            
            if (!currentVehicle) return;
            
            container.innerHTML = `
                <h2 class="vehicle-title">${currentVehicle.year} • ${currentVehicle.brand} ${currentVehicle.model}</h2>
                
                ${currentVehicle.sold ? '<div style="text-align: center; padding: 15px; background: linear-gradient(45deg, var(--secondary-color), var(--accent-color)); border-radius: 10px; margin-bottom: 20px; font-weight: 700;">🏆 VEHÍCULO VENDIDO</div>' : ''}
                
                <div class="detail-item">
                    <span class="detail-icon">🏁</span>
                    <span class="detail-label">Transmisión:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.transmission}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">❄️</span>
                    <span class="detail-label">A/A:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.ac}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🎛</span>
                    <span class="detail-label">Radio:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.radio}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🛣️</span>
                    <span class="detail-label">Recorrido:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.mileage}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🎨</span>
                    <span class="detail-label">Color:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.color}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🪪</span>
                    <span class="detail-label">Dueños:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.owners}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🔑</span>
                    <span class="detail-label">Llaves:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.keys}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🛞</span>
                    <span class="detail-label">Cauchos:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.tires}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🌎</span>
                    <span class="detail-label">Ubicación:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.location}</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">⚙️</span>
                    <span class="detail-label">Extras:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.extras || 'Ninguno'}</span>
                </div>
                
                ${currentVehicle.notes ? `
                <div class="detail-item">
                    <span class="detail-icon">📝</span>
                    <span class="detail-label">Notas:</span>
                    <div class="detail-dots"></div>
                    <span class="detail-value">${currentVehicle.notes}</span>
                </div>
                ` : ''}
                
                <div class="separator"></div>
                
                <div class="detail-item">
                    <span class="detail-icon">💵</span>
                    <span class="detail-label">Precio:</span>
                </div>
                <div class="price-modal ${currentVehicle.sold ? 'sold' : ''}">${currentVehicle.price}</div>
            `;
        }

        function contactOwner() {
            if (!currentVehicle) return;
            
            const ownerWhatsApp = currentVehicle.ownerWhatsApp || "+58 000 000 0000";
            const vehicleInfo = `${currentVehicle.year} ${currentVehicle.brand} ${currentVehicle.model}`;
            const message = `¡Hola! Estoy interesado en tu vehículo: ${vehicleInfo} por ${currentVehicle.price}. ¿Podríamos hablar sobre él?`;
            
            const whatsappUrl = `https://wa.me/${ownerWhatsApp.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // Analytics o tracking opcional
            console.log('📱 Contacto WhatsApp iniciado para:', vehicleInfo);
        }
        // Funciones de publicación mejoradas
        function openPublishModal() {
            document.getElementById('publishOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            resetPublishForm();
            
            // Ocultar notificación de admin si es administrador
            if (currentUser?.isAdmin) {
                const notice = document.getElementById('publicationNotice');
                notice.style.display = 'none';
            }
        }

        function closePublishModal() {
            document.getElementById('publishOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function resetPublishForm() {
            // Limpiar todos los campos del formulario
            const form = document.querySelector('#publishOverlay form');
            if (form) form.reset();
            
            uploadedImages = [];
            document.getElementById('imagePreviewGrid').innerHTML = '';
            
            // Resetear botón de submit
            const submitBtn = document.getElementById('publishSubmitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = '🚗 Publicar Vehículo';
        }

        async function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            
            if (uploadedImages.length + files.length > 10) {
                showNotification('Máximo 10 imágenes permitidas', 'error');
                return;
            }
            
            if (files.length === 0) return;
            
            showLoading();
            let successCount = 0;
            let errorCount = 0;
            
            try {
                for (const file of files) {
                    try {
                        const imageUrl = await uploadImageToFirebase(file);
                        uploadedImages.push(imageUrl);
                        successCount++;
                    } catch (error) {
                        console.error('Error uploading file:', file.name, error);
                        errorCount++;
                    }
                }
                
                renderImagePreviews();
                hideLoading();
                
                if (successCount > 0) {
                    showNotification(`${successCount} imagen(es) subida(s) exitosamente${errorCount > 0 ? `, ${errorCount} fallaron` : ''}`, 'success');
                } else if (errorCount > 0) {
                    showNotification('Error al subir las imágenes. Verifica el tamaño y formato.', 'error');
                }
            } catch (error) {
                hideLoading();
                showNotification('Error al procesar las imágenes', 'error');
            }
        }

        function renderImagePreviews() {
            const grid = document.getElementById('imagePreviewGrid');
            grid.innerHTML = '';
            
            uploadedImages.forEach((imageUrl, index) => {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
                    <img src="${imageUrl}" alt="Vista previa ${index + 1}" loading="lazy">
                    <button class="remove-image" onclick="removeImage(${index})" aria-label="Eliminar imagen ${index + 1}">&times;</button>
                `;
                grid.appendChild(preview);
            });
        }

        function removeImage(index) {
            if (index >= 0 && index < uploadedImages.length) {
                uploadedImages.splice(index, 1);
                renderImagePreviews();
                showNotification('Imagen eliminada', 'info');
            }
        }

        async function publishVehicle(event) {
            event.preventDefault();
            
            if (uploadedImages.length === 0) {
                showNotification('Debes subir al menos una imagen del vehículo', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('publishSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Publicando...';
            
            // Recopilar datos del formulario
            const vehicleData = {
                year: parseInt(document.getElementById('vehicleYear').value),
                brand: document.getElementById('vehicleBrand').value.trim(),
                model: document.getElementById('vehicleModel').value.trim(),
                price: document.getElementById('vehiclePrice').value.trim(),
                sold: false,
                featured: false,
                images: [...uploadedImages],
                transmission: document.getElementById('vehicleTransmission').value,
                ac: document.getElementById('vehicleAC').value,
                radio: document.getElementById('vehicleRadio').value,
                mileage: document.getElementById('vehicleMileage').value.trim(),
                color: document.getElementById('vehicleColor').value.trim(),
                owners: document.getElementById('vehicleOwners').value.trim(),
                keys: parseInt(document.getElementById('vehicleKeys').value),
                tires: document.getElementById('vehicleTires').value.trim(),
                location: document.getElementById('vehicleLocation').value.trim(),
                extras: document.getElementById('vehicleExtras').value.trim() || 'Ninguno',
                notes: document.getElementById('vehicleNotes').value.trim() || 'Sin notas adicionales',
                owner: currentUser.rif,
                ownerWhatsApp: currentUser.whatsapp,
                publishDate: new Date().toISOString(),
                publicationStatus: currentUser.isAdmin ? 'approved' : 'pending',
                publicationMessage: ''
            };
            
            try {
                await saveVehicleToFirebase(vehicleData);
                renderCatalog();
                closePublishModal();
                
                if (currentUser.isAdmin) {
                    showNotification('Vehículo publicado y aprobado automáticamente', 'success');
                }
            } catch (error) {
                console.error('Error publishing vehicle:', error);
                showNotification('Error al publicar vehículo. Intenta nuevamente.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '🚗 Publicar Vehículo';
            }
        }

        // Funciones del dashboard del usuario mejoradas
        async function loadUserDashboard() {
            if (!currentUser) return;
            
            const userVehicles = vehicles.filter(v => v.owner === currentUser.rif);
            const activeVehicles = userVehicles.filter(v => !v.sold && v.publicationStatus === 'approved');
            const pendingVehicles = userVehicles.filter(v => v.publicationStatus === 'pending');
            const soldVehicles = userVehicles.filter(v => v.sold);
            
            // Actualizar estadísticas
            document.getElementById('totalVehicles').textContent = userVehicles.length;
            document.getElementById('activeVehicles').textContent = activeVehicles.length;
            document.getElementById('pendingVehicles').textContent = pendingVehicles.length;
            document.getElementById('soldVehicles').textContent = soldVehicles.length;
            
            const grid = document.getElementById('userVehiclesGrid');
            const emptyState = document.getElementById('emptyDashboard');
            
            if (userVehicles.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                grid.style.display = 'grid';
                emptyState.style.display = 'none';
                
                grid.innerHTML = '';
                
                // Ordenar vehículos por fecha de publicación (más recientes primero)
                const sortedVehicles = userVehicles.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                
                sortedVehicles.forEach(vehicle => {
                    const card = document.createElement('div');
                    card.className = 'dashboard-card';
                    
                    let statusBadge = '';
                    let statusColor = '';
                    switch(vehicle.publicationStatus) {
                        case 'pending':
                            statusBadge = '⏳ PENDIENTE APROBACIÓN';
                            statusColor = 'var(--warning-color)';
                            break;
                        case 'approved':
                            statusBadge = vehicle.sold ? '🏆 VENDIDO' : '🚗 ACTIVO';
                            statusColor = vehicle.sold ? 'var(--accent-color)' : 'var(--success-color)';
                            break;
                        case 'rejected':
                            statusBadge = '❌ RECHAZADO';
                            statusColor = 'var(--error-color)';
                            break;
                        default:
                            statusBadge = '🚗 ACTIVO';
                            statusColor = 'var(--primary-color)';
                    }
                    
                    card.innerHTML = `
                        <div class="dashboard-card-header">
                            <div class="dashboard-card-title">${vehicle.year} ${vehicle.brand} ${vehicle.model}</div>
                            <div style="font-size: 1rem; color: ${statusColor}; font-weight: 700;">
                                ${statusBadge}
                            </div>
                        </div>
                        <div class="dashboard-card-body">
                            <img src="${vehicle.images[0]}" alt="${vehicle.brand} ${vehicle.model}" 
                                 class="dashboard-vehicle-image" loading="lazy">
                            <div class="dashboard-vehicle-info">
                                <span class="dashboard-vehicle-price">${vehicle.price}</span>
                                <span class="dashboard-vehicle-location">📍 ${vehicle.location}</span>
                            </div>
                            <div class="dashboard-vehicle-date">
                                🗓️ Publicado: ${new Date(vehicle.publishDate).toLocaleDateString('es-ES', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}
                            </div>
                            ${vehicle.publicationMessage ? `
                            <div class="dashboard-status-message">
                                <div class="dashboard-message-label">💬 Mensaje del admin:</div>
                                <div class="dashboard-message-text">${vehicle.publicationMessage}</div>
                            </div>
                            ` : ''}
                            <div class="card-actions">
                                ${vehicle.publicationStatus === 'approved' ? `
                                    <button class="btn-small btn-edit" onclick="openEditModal('${vehicle.id}')">✏️ Editar</button>
                                    <button class="btn-small btn-sold ${vehicle.sold ? 'active' : ''}" 
                                            onclick="toggleSoldStatus('${vehicle.id}')">
                                        ${vehicle.sold ? '↩️ Reactivar' : '💰 Marcar Vendido'}
                                    </button>
                                ` : ''}
                                <button class="btn-small btn-delete" onclick="deleteVehicle('${vehicle.id}')">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            }
        }

        // Funciones de gestión de vehículos mejoradas
        async function toggleSoldStatus(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            if (vehicle.owner !== currentUser.rif && !currentUser.isAdmin) {
                showNotification('No tienes permisos para modificar este vehículo', 'error');
                return;
            }
            
            const newSoldStatus = !vehicle.sold;
            
            try {
                await updateVehicleInFirebase(vehicleId, { sold: newSoldStatus });
                
                // Actualizar vistas según la sección actual
                if (currentSection === 'dashboard') {
                    loadUserDashboard();
                } else if (currentSection === 'admin') {
                    loadAdminPanel();
                }
                renderCatalog();
                
                const status = newSoldStatus ? 'vendido' : 'reactivado';
                showNotification(`¡Vehículo marcado como ${status}!`, 'success');
            } catch (error) {
                showNotification('Error al actualizar el estado del vehículo', 'error');
            }
        }

        async function deleteVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            if (vehicle.owner !== currentUser.rif && !currentUser.isAdmin) {
                showNotification('No tienes permisos para eliminar este vehículo', 'error');
                return;
            }
            
            const confirmMessage = `¿Estás seguro de que quieres eliminar la publicación del ${vehicle.year} ${vehicle.brand} ${vehicle.model}?`;
            if (confirm(confirmMessage)) {
                try {
                    await deleteVehicleFromFirebase(vehicleId);
                    
                    // Actualizar vistas según la sección actual
                    if (currentSection === 'dashboard') {
                        loadUserDashboard();
                    } else if (currentSection === 'admin') {
                        loadAdminPanel();
                    }
                    renderCatalog();
                } catch (error) {
                    showNotification('Error al eliminar vehículo', 'error');
                }
            }
        }

        function openEditModal(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            if (vehicle.owner !== currentUser.rif && !currentUser.isAdmin) {
                showNotification('No tienes permisos para editar este vehículo', 'error');
                return;
            }
            
            // Llenar formulario con datos actuales
            document.getElementById('editVehicleId').value = vehicle.id;
            document.getElementById('editVehicleYear').value = vehicle.year;
            document.getElementById('editVehicleBrand').value = vehicle.brand;
            document.getElementById('editVehicleModel').value = vehicle.model;
            document.getElementById('editVehiclePrice').value = vehicle.price;
            document.getElementById('editVehicleTransmission').value = vehicle.transmission;
            document.getElementById('editVehicleAC').value = vehicle.ac;
            document.getElementById('editVehicleRadio').value = vehicle.radio;
            document.getElementById('editVehicleMileage').value = vehicle.mileage;
            document.getElementById('editVehicleColor').value = vehicle.color;
            document.getElementById('editVehicleOwners').value = vehicle.owners;
            document.getElementById('editVehicleKeys').value = vehicle.keys;
            document.getElementById('editVehicleTires').value = vehicle.tires;
            document.getElementById('editVehicleLocation').value = vehicle.location;
            document.getElementById('editVehicleExtras').value = vehicle.extras;
            document.getElementById('editVehicleNotes').value = vehicle.notes;
            
            document.getElementById('editOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeEditModal() {
            document.getElementById('editOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        async function updateVehicle(event) {
            event.preventDefault();
            
            const vehicleId = document.getElementById('editVehicleId').value;
            const vehicle = vehicles.find(v => v.id === vehicleId);
            
            if (!vehicle) {
                showNotification('Vehículo no encontrado', 'error');
                return;
            }
            
            if (vehicle.owner !== currentUser.rif && !currentUser.isAdmin) {
                showNotification('No tienes permisos para editar este vehículo', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('editSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Actualizando...';
            
            const updatedData = {
                year: parseInt(document.getElementById('editVehicleYear').value),
                brand: document.getElementById('editVehicleBrand').value.trim(),
                model: document.getElementById('editVehicleModel').value.trim(),
                price: document.getElementById('editVehiclePrice').value.trim(),
                transmission: document.getElementById('editVehicleTransmission').value,
                ac: document.getElementById('editVehicleAC').value,
                radio: document.getElementById('editVehicleRadio').value,
                mileage: document.getElementById('editVehicleMileage').value.trim(),
                color: document.getElementById('editVehicleColor').value.trim(),
                owners: document.getElementById('editVehicleOwners').value.trim(),
                keys: parseInt(document.getElementById('editVehicleKeys').value),
                tires: document.getElementById('editVehicleTires').value.trim(),
                location: document.getElementById('editVehicleLocation').value.trim(),
                extras: document.getElementById('editVehicleExtras').value.trim(),
                notes: document.getElementById('editVehicleNotes').value.trim(),
                lastModified: new Date().toISOString()
            };
            
            try {
                await updateVehicleInFirebase(vehicleId, updatedData);
                
                // Actualizar vistas según la sección actual
                if (currentSection === 'dashboard') {
                    loadUserDashboard();
                } else if (currentSection === 'admin') {
                    loadAdminPanel();
                }
                renderCatalog();
                closeEditModal();
            } catch (error) {
                showNotification('Error al actualizar vehículo', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '✏️ Actualizar Vehículo';
            }
        }
        // Panel de administración mejorado
        async function loadAdminPanel() {
            if (!currentUser?.isAdmin) return;
            
            await loadUsersFromFirebase();
            loadAdminUsers();
            loadAdminVehicles();
            loadAdminPublications();
            loadAdminFeatured();
            loadAdminAdvertising();
        }

        function showAdminTab(tab) {
            // Remover clase active de todos los tabs
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            
            // Activar tab seleccionado
            document.querySelector(`[onclick="showAdminTab('${tab}')"]`).classList.add('active');
            document.getElementById('admin' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            
            // Cargar datos específicos del tab
            switch(tab) {
                case 'customization':
                    loadCustomizationPanel();
                    break;
                case 'advertising':
                    loadAdminAdvertising();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
                case 'vehicles':
                    loadAdminVehicles();
                    break;
                case 'publications':
                    loadAdminPublications();
                    break;
                case 'featured':
                    loadAdminFeatured();
                    break;
            }
        }

        function loadAdminUsers() {
            const verifiedUsers = users.filter(u => u.verificationStatus === 'verified');
            const pendingUsers = users.filter(u => u.verificationStatus === 'pending');
            const rejectedUsers = users.filter(u => u.verificationStatus === 'rejected');
            
            // Actualizar estadísticas
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('verifiedUsers').textContent = verifiedUsers.length;
            document.getElementById('pendingUsers').textContent = pendingUsers.length;
            document.getElementById('rejectedUsers').textContent = rejectedUsers.length;
            
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const userVehicles = vehicles.filter(v => v.owner === user.rif);
                const row = document.createElement('tr');
                
                let statusClass = '';
                let statusText = '';
                let actionText = '';
                
                switch(user.verificationStatus) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = '⏳ Pendiente';
                        actionText = '👁️ Revisar';
                        break;
                    case 'verified':
                        statusClass = 'status-approved';
                        statusText = '✅ Verificado';
                        actionText = '✏️ Cambiar';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = '❌ Rechazado';
                        actionText = '✏️ Cambiar';
                        break;
                }
                
                row.innerHTML = `
                    <td>${user.name} ${user.lastname}</td>
                    <td>${user.rif}</td>
                    <td>
                        <a href="https://wa.me/${user.whatsapp.replace(/\D/g, '')}" target="_blank" class="whatsapp-link">
                            ${user.whatsapp}
                        </a>
                    </td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${new Date(user.registrationDate).toLocaleDateString('es-ES')}</td>
                    <td>${userVehicles.length}</td>
                    <td class="admin-actions">
                        <button class="btn-small btn-edit" onclick="openVerificationModal('${user.id}')">
                            ${actionText}
                        </button>
                        <button class="btn-small btn-delete" onclick="deleteUser('${user.id}')">🗑️</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadAdminVehicles() {
            const activeVehicles = vehicles.filter(v => !v.sold && v.publicationStatus === 'approved');
            const soldVehicles = vehicles.filter(v => v.sold);
            const featuredVehicles = vehicles.filter(v => v.featured);
            
            // Actualizar estadísticas
            document.getElementById('adminTotalVehicles').textContent = vehicles.length;
            document.getElementById('adminActiveVehicles').textContent = activeVehicles.length;
            document.getElementById('adminSoldVehicles').textContent = soldVehicles.length;
            document.getElementById('adminFeaturedVehicles').textContent = featuredVehicles.length;
            
            const tbody = document.getElementById('vehiclesTableBody');
            tbody.innerHTML = '';
            
            // Ordenar vehículos por fecha de publicación (más recientes primero)
            const sortedVehicles = vehicles.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
            
            sortedVehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.year} ${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicle.price}</td>
                    <td>${vehicle.owner}</td>
                    <td style="color: ${vehicle.sold ? 'var(--accent-color)' : 'var(--success-color)'};">
                        ${vehicle.sold ? '🏆 VENDIDO' : '🚗 ACTIVO'}
                    </td>
                    <td>${new Date(vehicle.publishDate).toLocaleDateString('es-ES')}</td>
                    <td class="admin-actions">
                        <button class="btn-small btn-edit" onclick="openEditModal('${vehicle.id}')">✏️</button>
                        <button class="btn-small btn-featured ${vehicle.featured ? 'active' : ''}" onclick="toggleFeatured('${vehicle.id}')">
                            ${vehicle.featured ? '⭐' : '☆'}
                        </button>
                        <button class="btn-small btn-sold" onclick="adminToggleSold('${vehicle.id}')">
                            ${vehicle.sold ? '↩️' : '💰'}
                        </button>
                        <button class="btn-small btn-delete" onclick="deleteVehicle('${vehicle.id}')">🗑️</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadAdminPublications() {
            const pendingPublications = vehicles.filter(v => v.publicationStatus === 'pending');
            const approvedPublications = vehicles.filter(v => v.publicationStatus === 'approved');
            const rejectedPublications = vehicles.filter(v => v.publicationStatus === 'rejected');
            
            // Actualizar estadísticas
            document.getElementById('pendingPublications').textContent = pendingPublications.length;
            document.getElementById('approvedPublications').textContent = approvedPublications.length;
            document.getElementById('rejectedPublications').textContent = rejectedPublications.length;
            
            const tbody = document.getElementById('publicationsTableBody');
            tbody.innerHTML = '';
            
            // Ordenar publicaciones (pendientes primero, luego por fecha)
            const sortedVehicles = vehicles.sort((a, b) => {
                if (a.publicationStatus === 'pending' && b.publicationStatus !== 'pending') return -1;
                if (a.publicationStatus !== 'pending' && b.publicationStatus === 'pending') return 1;
                return new Date(b.publishDate) - new Date(a.publishDate);
            });
            
            sortedVehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                let statusText = '';
                let actions = '';
                
                switch(vehicle.publicationStatus) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = '⏳ Pendiente';
                        actions = `
                            <button class="btn-small btn-approve" onclick="openPublicationVerificationModal('${vehicle.id}')">👁️ Revisar</button>
                        `;
                        break;
                    case 'approved':
                        statusClass = 'status-approved';
                        statusText = '✅ Aprobado';
                        actions = `
                            <button class="btn-small btn-reject" onclick="rejectPublicationDirect('${vehicle.id}')">❌ Rechazar</button>
                        `;
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = '❌ Rechazado';
                        actions = `
                            <button class="btn-small btn-approve" onclick="approvePublicationDirect('${vehicle.id}')">✅ Aprobar</button>
                        `;
                        break;
                }
                
                row.innerHTML = `
                    <td>${vehicle.year} ${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicle.owner}</td>
                    <td>${new Date(vehicle.publishDate).toLocaleDateString('es-ES')}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td class="admin-actions">
                        ${actions}
                        <button class="btn-small btn-delete" onclick="deleteVehicle('${vehicle.id}')">🗑️</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadAdminFeatured() {
            const featuredVehicles = vehicles.filter(v => v.featured);
            const availableForFeatured = vehicles.filter(v => !v.featured && v.publicationStatus === 'approved' && !v.sold);
            
            // Actualizar estadísticas
            document.getElementById('totalFeaturedVehicles').textContent = featuredVehicles.length;
            document.getElementById('availableForFeatured').textContent = availableForFeatured.length;
            
            const tbody = document.getElementById('featuredTableBody');
            tbody.innerHTML = '';
            
            const approvedVehicles = vehicles.filter(v => v.publicationStatus === 'approved' && !v.sold);
            
            // Ordenar vehículos (destacados primero)
            const sortedVehicles = approvedVehicles.sort((a, b) => {
                if (a.featured && !b.featured) return -1;
                if (!a.featured && b.featured) return 1;
                return new Date(b.publishDate) - new Date(a.publishDate);
            });
            
            sortedVehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.year} ${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicle.owner}</td>
                    <td>${vehicle.price}</td>
                    <td style="color: ${vehicle.featured ? 'var(--accent-color)' : 'var(--text-muted)'};">
                        ${vehicle.featured ? '⭐ SÍ' : '☆ NO'}
                    </td>
                    <td class="admin-actions">
                        <button class="btn-small btn-featured ${vehicle.featured ? 'active' : ''}" onclick="toggleFeatured('${vehicle.id}')">
                            ${vehicle.featured ? '⭐ Quitar Destacado' : '☆ Destacar'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadAdminAdvertising() {
            const ad = siteConfig.advertising || {};
            
            // Llenar formulario con datos actuales
            document.getElementById('adTitle').value = ad.title || '';
            document.getElementById('adDescription').value = ad.description || '';
            document.getElementById('adWhatsApp').value = ad.whatsapp || '';
            document.getElementById('adWebsite').value = ad.website || '';
            
            // Mostrar imagen actual si existe
            const currentImage = document.getElementById('adCurrentImage');
            const uploadArea = document.getElementById('adImageUpload');
            
            if (ad.imageUrl) {
                currentImage.src = ad.imageUrl;
                currentImage.style.display = 'block';
                uploadArea.classList.add('has-image');
            } else {
                currentImage.style.display = 'none';
                uploadArea.classList.remove('has-image');
            }
            
            // Actualizar vista previa
            updateAdPreview();
        }

        async function handleAdImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const imageUrl = await uploadImageToFirebase(file);
                
                // Actualizar configuración temporalmente
                if (!siteConfig.advertising) {
                    siteConfig.advertising = {};
                }
                siteConfig.advertising.imageUrl = imageUrl;
                
                // Actualizar UI
                const currentImage = document.getElementById('adCurrentImage');
                const uploadArea = document.getElementById('adImageUpload');
                
                currentImage.src = imageUrl;
                currentImage.style.display = 'block';
                uploadArea.classList.add('has-image');
                
                updateAdPreview();
                showNotification('Imagen de publicidad subida exitosamente', 'success');
            } catch (error) {
                showNotification('Error al subir imagen de publicidad', 'error');
            }
        }

        function updateAdPreview() {
            const title = document.getElementById('adTitle').value;
            const description = document.getElementById('adDescription').value;
            const whatsapp = document.getElementById('adWhatsApp').value;
            const website = document.getElementById('adWebsite').value;
            const imageUrl = siteConfig.advertising?.imageUrl;
            
            const preview = document.getElementById('adPreview');
            
            if (title || description || imageUrl) {
                preview.style.display = 'block';
                
                document.getElementById('adPreviewTitle').textContent = title || 'Título de la publicidad';
                document.getElementById('adPreviewDescription').textContent = description || 'Descripción de la publicidad';
                
                const previewImage = document.getElementById('adPreviewImage');
                if (imageUrl) {
                    previewImage.src = imageUrl;
                    previewImage.style.display = 'block';
                } else {
                    previewImage.style.display = 'none';
                }
                
                const whatsappBtn = document.getElementById('adPreviewWhatsApp');
                const websiteBtn = document.getElementById('adPreviewWebsite');
                
                whatsappBtn.style.display = whatsapp ? 'inline-flex' : 'none';
                websiteBtn.style.display = website ? 'inline-flex' : 'none';
            } else {
                preview.style.display = 'none';
            }
        }

        // Agregar event listeners para actualizar preview en tiempo real
        function setupAdPreviewListeners() {
            const inputs = ['adTitle', 'adDescription', 'adWhatsApp', 'adWebsite'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateAdPreview);
                }
            });
        }

        async function saveAdvertising(event) {
            event.preventDefault();
            
            const title = document.getElementById('adTitle').value.trim();
            const description = document.getElementById('adDescription').value.trim();
            const whatsapp = document.getElementById('adWhatsApp').value.trim();
            const website = document.getElementById('adWebsite').value.trim();
            const imageUrl = siteConfig.advertising?.imageUrl;
            
            // Validaciones
            if (!title && !description && !imageUrl) {
                showNotification('Completa al menos el título, descripción o imagen', 'error');
                return;
            }
            
            if (whatsapp && !whatsapp.match(/^\+?[\d\s\-\(\)]{10,}$/)) {
                showNotification('Formato de WhatsApp inválido', 'error');
                return;
            }
            
            if (website && !website.match(/^https?:\/\/.+/)) {
                showNotification('La URL del sitio web debe comenzar con http:// o https://', 'error');
                return;
            }
            
            // Actualizar configuración
            siteConfig.advertising = {
                enabled: !!(title && description && imageUrl),
                title,
                description,
                whatsapp,
                website,
                imageUrl: imageUrl || ''
            };
            
            try {
                await saveConfigToFirebase();
                renderCatalog(); // Actualizar catálogo para mostrar/ocultar publicidad
                showNotification('Publicidad guardada exitosamente', 'success');
            } catch (error) {
                showNotification('Error al guardar publicidad', 'error');
            }
        }

        function clearAdvertising() {
            if (confirm('¿Estás seguro de que quieres limpiar toda la configuración de publicidad?')) {
                // Limpiar formulario
                document.getElementById('adTitle').value = '';
                document.getElementById('adDescription').value = '';
                document.getElementById('adWhatsApp').value = '';
                document.getElementById('adWebsite').value = '';
                
                // Limpiar imagen
                const currentImage = document.getElementById('adCurrentImage');
                const uploadArea = document.getElementById('adImageUpload');
                currentImage.style.display = 'none';
                uploadArea.classList.remove('has-image');
                
                // Limpiar configuración
                siteConfig.advertising = {
                    enabled: false,
                    title: '',
                    description: '',
                    whatsapp: '',
                    website: '',
                    imageUrl: ''
                };
                
                updateAdPreview();
                showNotification('Configuración de publicidad limpiada', 'info');
            }
        }
        // Funciones auxiliares para administración
        async function toggleFeatured(vehicleId) {
            if (!currentUser?.isAdmin) return;
            
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            // Solo vehículos aprobados y no vendidos pueden ser destacados
            if (vehicle.publicationStatus !== 'approved' || vehicle.sold) {
                showNotification('Solo se pueden destacar vehículos aprobados y disponibles', 'warning');
                return;
            }
            
            try {
                await updateVehicleInFirebase(vehicleId, { featured: !vehicle.featured });
                loadAdminPanel();
                renderCatalog();
                showNotification(`Vehículo ${vehicle.featured ? 'removido de' : 'agregado a'} destacados`, 'success');
            } catch (error) {
                showNotification('Error al actualizar destacado', 'error');
            }
        }

        async function adminToggleSold(vehicleId) {
            if (!currentUser?.isAdmin) return;
            await toggleSoldStatus(vehicleId);
        }

        async function deleteUser(userId) {
            if (!currentUser?.isAdmin) return;
            
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const userVehicles = vehicles.filter(v => v.owner === user.rif);
            let confirmMessage = `¿Estás seguro de que quieres eliminar al usuario "${user.name} ${user.lastname}"?`;
            
            if (userVehicles.length > 0) {
                confirmMessage += `\n\nEste usuario tiene ${userVehicles.length} vehículo(s) publicado(s). También serán eliminados.`;
            }
            
            if (confirm(confirmMessage)) {
                try {
                    // Eliminar vehículos del usuario primero
                    for (const vehicle of userVehicles) {
                        await deleteVehicleFromFirebase(vehicle.id);
                    }
                    
                    // Luego eliminar usuario
                    await deleteUserFromFirebase(userId);
                    loadAdminUsers();
                    renderCatalog();
                } catch (error) {
                    showNotification('Error al eliminar usuario', 'error');
                }
            }
        }

        // Funciones de verificación de usuarios
        function openVerificationModal(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            currentUserToVerify = user;
            
            const userInfo = document.getElementById('userVerificationInfo');
            userInfo.innerHTML = `
                <h3>📋 Información del Usuario</h3>
                <div class="info-item">
                    <span class="info-label">👤 Nombre:</span>
                    <span class="info-value">${user.name} ${user.lastname}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">🆔 RIF:</span>
                    <span class="info-value">${user.rif}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">📱 WhatsApp:</span>
                    <span class="info-value">
                        <a href="https://wa.me/${user.whatsapp.replace(/\D/g, '')}" target="_blank" class="whatsapp-link">
                            ${user.whatsapp}
                        </a>
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">📅 Registro:</span>
                    <span class="info-value">${new Date(user.registrationDate).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">📊 Estado:</span>
                    <span class="info-value status-${user.verificationStatus}">
                        ${user.verificationStatus === 'pending' ? '⏳ Pendiente' : 
                          user.verificationStatus === 'verified' ? '✅ Verificado' : '❌ Rechazado'}
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">🚗 Publicaciones:</span>
                    <span class="info-value">${vehicles.filter(v => v.owner === user.rif).length}</span>
                </div>
                ${user.verificationMessage ? `
                <div class="info-item">
                    <span class="info-label">💬 Último mensaje:</span>
                    <span class="info-value">${user.verificationMessage}</span>
                </div>
                ` : ''}
            `;
            
            document.getElementById('verificationMessage').value = '';
            document.getElementById('verificationOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeVerificationModal() {
            document.getElementById('verificationOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentUserToVerify = null;
        }

        async function approveUser() {
            if (!currentUserToVerify) return;
            
            const customMessage = document.getElementById('verificationMessage').value.trim();
            const defaultMessage = `¡Felicidades! Tu cuenta en ${siteConfig.siteName} ha sido verificada exitosamente. Ya puedes iniciar sesión y publicar tus vehículos.`;
            const finalMessage = customMessage || defaultMessage;
            
            const updatedData = {
                verificationStatus: 'verified',
                verified: true,
                verificationMessage: finalMessage,
                verificationDate: new Date().toISOString()
            };
            
            try {
                await updateUserInFirebase(currentUserToVerify.id, updatedData);
                sendVerificationWhatsApp(currentUserToVerify.whatsapp, finalMessage, '✅ CUENTA VERIFICADA');
                closeVerificationModal();
                loadAdminUsers();
                showNotification(`Usuario ${currentUserToVerify.name} verificado exitosamente`, 'success');
            } catch (error) {
                showNotification('Error al verificar usuario', 'error');
            }
        }

        async function rejectUser() {
            if (!currentUserToVerify) return;
            
            const customMessage = document.getElementById('verificationMessage').value.trim();
            let finalMessage = customMessage;
            
            if (!customMessage) {
                const reason = prompt('¿Cuál es el motivo del rechazo?');
                if (reason) {
                    finalMessage = `Tu solicitud de cuenta en ${siteConfig.siteName} ha sido rechazada.\n\nMotivo: ${reason}\n\nPara más información, contacta al administrador.`;
                } else {
                    finalMessage = `Tu solicitud de cuenta en ${siteConfig.siteName} ha sido rechazada. Para más información, contacta al administrador.`;
                }
            }
            
            const updatedData = {
                verificationStatus: 'rejected',
                verified: false,
                verificationMessage: finalMessage,
                verificationDate: new Date().toISOString()
            };
            
            try {
                await updateUserInFirebase(currentUserToVerify.id, updatedData);
                sendVerificationWhatsApp(currentUserToVerify.whatsapp, finalMessage, '❌ CUENTA RECHAZADA');
                closeVerificationModal();
                loadAdminUsers();
                showNotification(`Usuario ${currentUserToVerify.name} rechazado`, 'info');
            } catch (error) {
                showNotification('Error al rechazar usuario', 'error');
            }
        }

        function sendVerificationWhatsApp(phoneNumber, message, status) {
            const fullMessage = `${status}\n\n${message}\n\n--\n${siteConfig.siteName}`;
            const whatsappUrl = `https://wa.me/${phoneNumber.replace(/\D/g, '')}?text=${encodeURIComponent(fullMessage)}`;
            
            const sendNow = confirm('¿Quieres enviar la notificación por WhatsApp ahora?');
            if (sendNow) {
                window.open(whatsappUrl, '_blank');
            }
        }

        // Funciones de verificación de publicaciones
        function openPublicationVerificationModal(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            currentPublicationToVerify = vehicle;
            
            const publicationInfo = document.getElementById('publicationVerificationInfo');
            publicationInfo.innerHTML = `
                <h3>🚗 Información de la Publicación</h3>
                <div class="info-item">
                    <span class="info-label">🚗 Vehículo:</span>
                    <span class="info-value">${vehicle.year} ${vehicle.brand} ${vehicle.model}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">💰 Precio:</span>
                    <span class="info-value">${vehicle.price}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">👤 Propietario:</span>
                    <span class="info-value">${vehicle.owner}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">📱 WhatsApp:</span>
                    <span class="info-value">
                        <a href="https://wa.me/${vehicle.ownerWhatsApp.replace(/\D/g, '')}" target="_blank" class="whatsapp-link">
                            ${vehicle.ownerWhatsApp}
                        </a>
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">📅 Fecha:</span>
                    <span class="info-value">${new Date(vehicle.publishDate).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">🌎 Ubicación:</span>
                    <span class="info-value">${vehicle.location}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">🏁 Transmisión:</span>
                    <span class="info-value">${vehicle.transmission}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">🛣️ Recorrido:</span>
                    <span class="info-value">${vehicle.mileage}</span>
                </div>
                ${vehicle.notes !== 'Sin notas adicionales' ? `
                <div class="info-item">
                    <span class="info-label">📝 Notas:</span>
                    <span class="info-value">${vehicle.notes}</span>
                </div>
                ` : ''}
                <div style="margin-top: 20px;">
                    <strong style="color: var(--primary-color);">📸 Imágenes del vehículo:</strong>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px;">
                        ${vehicle.images.map((img, index) => `
                            <img src="${img}" alt="Imagen ${index + 1}" 
                                 style="width: 100%; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer;"
                                 onclick="window.open('${img}', '_blank')">
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('publicationVerificationMessage').value = '';
            document.getElementById('publicationVerificationOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closePublicationVerificationModal() {
            document.getElementById('publicationVerificationOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentPublicationToVerify = null;
        }

        async function approvePublication() {
            if (!currentPublicationToVerify) return;
            
            const customMessage = document.getElementById('publicationVerificationMessage').value.trim();
            const defaultMessage = `¡Excelente! Tu publicación del ${currentPublicationToVerify.year} ${currentPublicationToVerify.brand} ${currentPublicationToVerify.model} ha sido aprobada y ya está visible en ${siteConfig.siteName}.`;
            const finalMessage = customMessage || defaultMessage;
            
            const updatedData = {
                publicationStatus: 'approved',
                publicationMessage: finalMessage,
                approvalDate: new Date().toISOString()
            };
            
            try {
                await updateVehicleInFirebase(currentPublicationToVerify.id, updatedData);
                sendPublicationWhatsApp(currentPublicationToVerify.ownerWhatsApp, finalMessage, '✅ PUBLICACIÓN APROBADA');
                closePublicationVerificationModal();
                loadAdminPublications();
                renderCatalog();
                showNotification('Publicación aprobada exitosamente', 'success');
            } catch (error) {
                showNotification('Error al aprobar publicación', 'error');
            }
        }

        async function rejectPublication() {
            if (!currentPublicationToVerify) return;
            
            const customMessage = document.getElementById('publicationVerificationMessage').value.trim();
            let finalMessage = customMessage;
            
            if (!customMessage) {
                const reason = prompt('¿Cuál es el motivo del rechazo?');
                if (reason) {
                    finalMessage = `Tu publicación del ${currentPublicationToVerify.year} ${currentPublicationToVerify.brand} ${currentPublicationToVerify.model} ha sido rechazada.\n\nMotivo: ${reason}\n\nPuedes editarla y volver a publicarla.`;
                } else {
                    finalMessage = `Tu publicación del ${currentPublicationToVerify.year} ${currentPublicationToVerify.brand} ${currentPublicationToVerify.model} ha sido rechazada. Contacta al administrador para más información.`;
                }
            }
            
            const updatedData = {
                publicationStatus: 'rejected',
                publicationMessage: finalMessage,
                rejectionDate: new Date().toISOString()
            };
            
            try {
                await updateVehicleInFirebase(currentPublicationToVerify.id, updatedData);
                sendPublicationWhatsApp(currentPublicationToVerify.ownerWhatsApp, finalMessage, '❌ PUBLICACIÓN RECHAZADA');
                closePublicationVerificationModal();
                loadAdminPublications();
                showNotification('Publicación rechazada', 'info');
            } catch (error) {
                showNotification('Error al rechazar publicación', 'error');
            }
        }

        function sendPublicationWhatsApp(phoneNumber, message, status) {
            const fullMessage = `${status}\n\n${message}\n\n--\n${siteConfig.siteName}`;
            const whatsappUrl = `https://wa.me/${phoneNumber.replace(/\D/g, '')}?text=${encodeURIComponent(fullMessage)}`;
            
            const sendNow = confirm('¿Quieres enviar la notificación por WhatsApp ahora?');
            if (sendNow) {
                window.open(whatsappUrl, '_blank');
            }
        }

        // Funciones rápidas para aprobar/rechazar sin modal
        async function approvePublicationDirect(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            if (confirm(`¿Aprobar la publicación del ${vehicle.year} ${vehicle.brand} ${vehicle.model}?`)) {
                const defaultMessage = `¡Excelente! Tu publicación del ${vehicle.year} ${vehicle.brand} ${vehicle.model} ha sido aprobada y ya está visible en ${siteConfig.siteName}.`;
                
                const updatedData = {
                    publicationStatus: 'approved',
                    publicationMessage: defaultMessage,
                    approvalDate: new Date().toISOString()
                };
                
                try {
                    await updateVehicleInFirebase(vehicleId, updatedData);
                    loadAdminPublications();
                    renderCatalog();
                    showNotification('Publicación aprobada exitosamente', 'success');
                } catch (error) {
                    showNotification('Error al aprobar publicación', 'error');
                }
            }
        }

        async function rejectPublicationDirect(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            const reason = prompt(`¿Cuál es el motivo para rechazar la publicación del ${vehicle.year} ${vehicle.brand} ${vehicle.model}?`);
            if (reason) {
                const message = `Tu publicación del ${vehicle.year} ${vehicle.brand} ${vehicle.model} ha sido rechazada.\n\nMotivo: ${reason}\n\nPuedes editarla y volver a publicarla.`;
                
                const updatedData = {
                    publicationStatus: 'rejected',
                    publicationMessage: message,
                    rejectionDate: new Date().toISOString()
                };
                
                try {
                    await updateVehicleInFirebase(vehicleId, updatedData);
                    loadAdminPublications();
                    showNotification('Publicación rechazada', 'info');
                } catch (error) {
                    showNotification('Error al rechazar publicación', 'error');
                }
            }
        }
        // Funciones de personalización mejoradas
        function loadCustomizationPanel() {
            if (!currentUser?.isAdmin) return;
            
            // Cargar valores actuales
            document.getElementById('primaryColor').value = siteConfig.primaryColor;
            document.getElementById('secondaryColor').value = siteConfig.secondaryColor;
            document.getElementById('siteName').value = siteConfig.siteName;
            document.getElementById('instagramUrl').value = siteConfig.socialLinks.instagram || '';
            document.getElementById('facebookUrl').value = siteConfig.socialLinks.facebook || '';
            document.getElementById('tiktokUrl').value = siteConfig.socialLinks.tiktok || '';
            
            // Actualizar selección de banner
            updateBannerSelection();
        }

        function updateBannerSelection() {
            document.querySelectorAll('.banner-option').forEach((option, index) => {
                option.classList.toggle('active', index === siteConfig.bannerStyle);
            });
        }

        function updateColors() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            
            siteConfig.primaryColor = primaryColor;
            siteConfig.secondaryColor = secondaryColor;
            
            applySiteConfig();
            showNotification('Colores actualizados. Recuerda guardar la configuración.', 'info');
        }

        function resetColors() {
            siteConfig.primaryColor = "#00d4ff";
            siteConfig.secondaryColor = "#ff6b35";
            
            document.getElementById('primaryColor').value = siteConfig.primaryColor;
            document.getElementById('secondaryColor').value = siteConfig.secondaryColor;
            
            applySiteConfig();
            showNotification('Colores restablecidos a valores por defecto', 'info');
        }

        function updateSiteName() {
            const siteName = document.getElementById('siteName').value.trim() || "AutoVentas Premium";
            siteConfig.siteName = siteName;
            
            document.getElementById('logoText').textContent = `🏎️ ${siteName}`;
            document.getElementById('siteTitle').textContent = `${siteName} - Vehículos Premium`;
            
            showNotification('Nombre del sitio actualizado. Recuerda guardar la configuración.', 'info');
        }

        async function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const logoUrl = await uploadLogoToFirebase(file);
                siteConfig.logoUrl = logoUrl;
                applySiteConfig();
                showNotification('Logo subido exitosamente. Recuerda guardar la configuración.', 'success');
            } catch (error) {
                showNotification('Error al subir logo. Verifica el tamaño y formato.', 'error');
            }
        }

        function removeLogo() {
            if (confirm('¿Estás seguro de que quieres quitar el logo?')) {
                siteConfig.logoUrl = '';
                applySiteConfig();
                showNotification('Logo eliminado. Recuerda guardar la configuración.', 'info');
            }
        }

        function setBannerStyle(styleIndex) {
            siteConfig.bannerStyle = styleIndex;
            updateBannerSelection();
            applySiteConfig();
            showNotification('Estilo de banner actualizado. Recuerda guardar la configuración.', 'info');
        }

        function updateSocialLinks() {
            siteConfig.socialLinks.instagram = document.getElementById('instagramUrl').value.trim();
            siteConfig.socialLinks.facebook = document.getElementById('facebookUrl').value.trim();
            siteConfig.socialLinks.tiktok = document.getElementById('tiktokUrl').value.trim();
            
            renderSocialLinks();
            showNotification('Redes sociales actualizadas. Recuerda guardar la configuración.', 'info');
        }

        async function saveCustomization() {
            if (!currentUser?.isAdmin) return;
            
            try {
                await saveConfigToFirebase();
                showNotification('Configuración guardada exitosamente', 'success');
            } catch (error) {
                showNotification('Error al guardar configuración', 'error');
            }
        }

        async function loadCustomization() {
            if (!currentUser?.isAdmin) return;
            
            try {
                await loadConfigFromFirebase();
                loadCustomizationPanel();
                showNotification('Configuración cargada exitosamente', 'success');
            } catch (error) {
                showNotification('Error al cargar configuración', 'error');
            }
        }

        function resetCustomization() {
            if (!currentUser?.isAdmin) return;
            
            if (confirm('¿Estás seguro de que quieres restablecer toda la configuración a valores por defecto?')) {
                siteConfig = {
                    siteName: "AutoVentas Premium",
                    primaryColor: "#00d4ff",
                    secondaryColor: "#ff6b35",
                    logoUrl: "",
                    bannerStyle: 0,
                    socialLinks: {
                        instagram: "",
                        facebook: "",
                        tiktok: ""
                    },
                    advertising: {
                        enabled: false,
                        title: "",
                        description: "",
                        imageUrl: "",
                        whatsapp: "",
                        website: ""
                    }
                };
                
                applySiteConfig();
                loadCustomizationPanel();
                showNotification('Configuración restablecida. Recuerda guardar los cambios.', 'info');
            }
        }

        // Aplicar configuración del sitio
        function applySiteConfig() {
            // Aplicar colores
            document.documentElement.style.setProperty('--primary-color', siteConfig.primaryColor);
            document.documentElement.style.setProperty('--secondary-color', siteConfig.secondaryColor);
            
            // Aplicar nombre del sitio
            document.getElementById('logoText').textContent = `🏎️ ${siteConfig.siteName}`;
            document.getElementById('siteTitle').textContent = `${siteConfig.siteName} - Vehículos Premium`;
            
            // Aplicar logo
            const logoImg = document.getElementById('logoImage');
            const logoText = document.getElementById('logoText');
            
            if (siteConfig.logoUrl) {
                logoImg.src = siteConfig.logoUrl;
                logoImg.style.display = 'block';
                logoText.style.display = 'none';
            } else {
                logoImg.style.display = 'none';
                logoText.style.display = 'block';
            }
            
            // Aplicar estilo de banner
            setBannerStyleClass(siteConfig.bannerStyle);
            
            // Aplicar redes sociales
            renderSocialLinks();
        }

        function setBannerStyleClass(styleIndex) {
            const header = document.getElementById('headerElement');
            header.className = 'header';
            
            if (styleIndex > 0) {
                header.classList.add(`banner-style-${styleIndex}`);
            }
        }

        function renderSocialLinks() {
            const container = document.getElementById('socialLinks');
            container.innerHTML = '';
            
            const socialNetworks = [
                { name: 'Instagram', url: siteConfig.socialLinks.instagram, icon: '📷', color: '#E4405F' },
                { name: 'Facebook', url: siteConfig.socialLinks.facebook, icon: '📘', color: '#1877F2' },
                { name: 'TikTok', url: siteConfig.socialLinks.tiktok, icon: '🎵', color: '#000000' }
            ];
            
            const validLinks = socialNetworks.filter(social => social.url && social.url.trim() !== '');
            
            if (validLinks.length === 0) {
                document.getElementById('socialSection').style.display = 'none';
                return;
            }
            
            document.getElementById('socialSection').style.display = 'block';
            
            validLinks.forEach(social => {
                const link = document.createElement('a');
                link.href = social.url;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                link.className = 'social-link';
                link.innerHTML = `
                    <span class="social-icon">${social.icon}</span>
                    <span>${social.name}</span>
                `;
                container.appendChild(link);
            });
        }

        // Funciones de gestión de datos
        function exportData(type) {
            if (!currentUser?.isAdmin) return;
            
            let data;
            let filename;
            
            switch(type) {
                case 'users':
                    data = users;
                    filename = `usuarios_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                case 'vehicles':
                    data = vehicles;
                    filename = `vehiculos_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                case 'all':
                    data = {
                        users: users,
                        vehicles: vehicles,
                        config: siteConfig,
                        exportDate: new Date().toISOString(),
                        version: '1.0'
                    };
                    filename = `backup_completo_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                default:
                    showNotification('Tipo de exportación no válido', 'error');
                    return;
            }
            
            try {
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification(`Datos exportados exitosamente: ${filename}`, 'success');
                console.log('📤 Datos exportados:', filename);
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Error al exportar datos', 'error');
            }
        }

        function backupFirebaseData() {
            if (!currentUser?.isAdmin) return;
            
            if (confirm('¿Crear un backup completo de todos los datos?')) {
                exportData('all');
            }
        }

        function clearFirebaseData() {
            if (!currentUser?.isAdmin) return;
            
            const confirmText = 'ELIMINAR TODOS LOS DATOS';
            const userInput = prompt(`⚠️ ADVERTENCIA CRÍTICA ⚠️

Esta acción eliminará PERMANENTEMENTE todos los datos de Firebase:
- Todos los usuarios registrados
- Todas las publicaciones de vehículos
- Toda la configuración del sitio

Esta acción NO SE PUEDE DESHACER.

Para confirmar, escribe exactamente: ${confirmText}`);
            
            if (userInput === confirmText) {
                const finalConfirm = confirm('¿Estás ABSOLUTAMENTE SEGURO de que quieres eliminar todos los datos? Esta es tu última oportunidad para cancelar.');
                
                if (finalConfirm) {
                    performFirebaseClear();
                }
            } else if (userInput !== null) {
                showNotification('Texto de confirmación incorrecto. Operación cancelada.', 'warning');
            }
        }

        async function performFirebaseClear() {
            try {
                showLoading();
                
                // Eliminar todos los vehículos
                for (const vehicle of vehicles) {
                    await deleteVehicleFromFirebase(vehicle.id);
                }
                
                // Eliminar todos los usuarios
                for (const user of users) {
                    await deleteUserFromFirebase(user.id);
                }
                
                // Limpiar configuración
                siteConfig = {
                    siteName: "AutoVentas Premium",
                    primaryColor: "#00d4ff",
                    secondaryColor: "#ff6b35",
                    logoUrl: "",
                    bannerStyle: 0,
                    socialLinks: {
                        instagram: "",
                        facebook: "",
                        tiktok: ""
                    },
                    advertising: {
                        enabled: false,
                        title: "",
                        description: "",
                        imageUrl: "",
                        whatsapp: "",
                        website: ""
                    }
                };
                
                await saveConfigToFirebase();
                
                // Reinicializar arrays
                vehicles = [];
                users = [];
                
                // Actualizar UI
                applySiteConfig();
                renderCatalog();
                if (currentSection === 'admin') {
                    loadAdminPanel();
                }
                
                hideLoading();
                showNotification('Todos los datos han sido eliminados permanentemente', 'success');
                console.log('🗑️ Firebase data cleared completely');
                
            } catch (error) {
                hideLoading();
                console.error('Error clearing Firebase data:', error);
                showNotification('Error al limpiar datos de Firebase', 'error');
            }
        }

        // Event listeners y funciones de inicialización
        document.addEventListener('keydown', (e) => {
            // Modal de vehículo
            if (document.getElementById('overlay').style.display === 'flex') {
                if (e.key === 'Escape') closeModal();
                if (e.key === 'ArrowLeft') prevImage();
                if (e.key === 'ArrowRight') nextImage();
            }
            
            // Otros modales
            const overlays = ['authOverlay', 'publishOverlay', 'editOverlay', 'verificationOverlay', 'publicationVerificationOverlay'];
            overlays.forEach(overlayId => {
                if (document.getElementById(overlayId).style.display === 'flex' && e.key === 'Escape') {
                    document.getElementById(overlayId).style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Panel de búsqueda
            if (searchPanelOpen && e.key === 'Escape') {
                toggleSearchPanel();
            }
        });

        // Cerrar modales al hacer click fuera
        ['overlay', 'authOverlay', 'publishOverlay', 'editOverlay', 'verificationOverlay', 'publicationVerificationOverlay'].forEach(overlayId => {
            document.getElementById(overlayId).addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    e.currentTarget.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Resetear variables globales si es necesario
                    if (overlayId === 'verificationOverlay') {
                        currentUserToVerify = null;
                    } else if (overlayId === 'publicationVerificationOverlay') {
                        currentPublicationToVerify = null;
                    }
                }
            });
        });

        // Cerrar panel de búsqueda al hacer click fuera
        document.getElementById('searchFilterSection').addEventListener('click', (e) => {
            if (e.target === e.currentTarget && searchPanelOpen) {
                toggleSearchPanel();
            }
        });

        // Prevenir envío de formularios con Enter en campos de texto
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target.tagName === 'INPUT' && e.target.type === 'text') {
                // Solo permitir en el campo de búsqueda
                if (e.target.id !== 'searchInput') {
                    e.preventDefault();
                }
            }
        });

        // Optimización para dispositivos móviles
        function handleMobileOptimizations() {
            // Detectar dispositivo móvil
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // Reducir número de imágenes en thumbnails para mejor rendimiento
                const thumbnails = document.querySelectorAll('.thumbnail');
                if (thumbnails.length > 6) {
                    thumbnails.forEach((thumb, index) => {
                        if (index > 5) {
                            thumb.style.display = 'none';
                        }
                    });
                }
                
                // Lazy loading más agresivo en móviles
                const images = document.querySelectorAll('img[loading="lazy"]');
                images.forEach(img => {
                    img.loading = 'lazy';
                });
            }
        }

        // Listener para cambios de tamaño de ventana
        window.addEventListener('resize', () => {
            handleMobileOptimizations();
            
            // Cerrar panel de búsqueda en cambio de orientación móvil
            if (window.innerWidth <= 768 && searchPanelOpen) {
                toggleSearchPanel();
            }
        });
        // Inicialización de la aplicación
        async function initApp() {
            try {
                showLoading();
                
                if (!window.db) {
                    throw new Error('Firebase no está inicializado correctamente');
                }
                
                console.log('🚀 Iniciando AutoVentas...');
                
                // Cargar configuración primero
                await loadConfigFromFirebase();
                console.log('✅ Configuración cargada');
                
                // Cargar datos principales
                await Promise.all([
                    loadVehiclesFromFirebase(),
                    loadUsersFromFirebase()
                ]);
                
                // Verificar sesión de usuario
                isLoggedIn();
                
                // Aplicar configuración del sitio
                applySiteConfig();
                
                // Configurar listeners para preview de publicidad
                setupAdPreviewListeners();
                
                // Optimizaciones para móviles
                handleMobileOptimizations();
                
                // Configurar visibilidad inicial del botón de búsqueda
                updateSearchButtonVisibility();
                
                hideLoading();
                showNotification('AutoVentas cargado exitosamente', 'success');
                console.log('🎉 AutoVentas inicializado correctamente');
                
            } catch (error) {
                console.error('❌ Error initializing app:', error);
                hideLoading();
                showNotification('Error al cargar la aplicación. Verifica la configuración de Firebase.', 'error');
                
                // Mostrar información de depuración en caso de error
                console.log('Debug info:', {
                    firebase: !!window.db,
                    modules: !!window.firebaseModules,
                    config: siteConfig
                });
            }
        }

        // Funciones de utilidad adicionales
        function formatPrice(price) {
            // Formatear precio para mostrar
            if (typeof price === 'string') {
                return price;
            }
            return new Intl.NumberFormat('es-VE', {
                style: 'currency',
                currency: 'USD'
            }).format(price);
        }

        function formatDate(dateString) {
            // Formatear fecha para mostrar
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function validateImageFile(file) {
            // Validar archivo de imagen
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            const maxSize = 5 * 1024 * 1024; // 5MB
            
            if (!allowedTypes.includes(file.type)) {
                throw new Error('Formato de imagen no permitido. Usa JPG, PNG o WebP.');
            }
            
            if (file.size > maxSize) {
                throw new Error('La imagen es demasiado grande. Máximo 5MB.');
            }
            
            return true;
        }

        function compressImage(file, maxWidth = 1200, quality = 0.8) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    // Calcular nuevas dimensiones manteniendo proporción
                    let { width, height } = img;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Dibujar imagen redimensionada
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convertir a blob
                    canvas.toBlob(resolve, 'image/jpeg', quality);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Búsqueda con debounce para mejor rendimiento
        const debouncedSearch = debounce(handleSearch, 300);

        // Actualizar el event listener de búsqueda
        function setupSearchListeners() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.removeEventListener('keyup', handleSearch);
                searchInput.addEventListener('keyup', debouncedSearch);
            }
        }

        // Funciones de analytics y tracking (opcional)
        function trackEvent(action, category, label) {
            // Placeholder para analytics
            console.log('📊 Event tracked:', { action, category, label });
        }

        function trackVehicleView(vehicle) {
            trackEvent('view_vehicle', 'vehicles', `${vehicle.year} ${vehicle.brand} ${vehicle.model}`);
        }

        function trackContact(vehicle) {
            trackEvent('contact_owner', 'vehicles', `${vehicle.year} ${vehicle.brand} ${vehicle.model}`);
        }

        // Funciones de accesibilidad mejoradas
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            element.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        }

        // Aplicar trap de foco a modales cuando se abran
        function enhanceModalAccessibility() {
            const modals = document.querySelectorAll('.overlay');
            modals.forEach(modal => {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'style') {
                            if (modal.style.display === 'flex') {
                                trapFocus(modal);
                                announceToScreenReader('Modal abierto');
                            }
                        }
                    });
                });
                
                observer.observe(modal, { attributes: true });
            });
        }

        // Funciones de rendimiento
        function optimizeImages() {
            // Implementar lazy loading para imágenes
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.classList.remove('loading-skeleton');
                            observer.unobserve(img);
                        }
                    });
                });

                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            }
        }

        function preloadCriticalImages() {
            // Precargar imágenes críticas
            const criticalImages = document.querySelectorAll('.vehicle-card img');
            criticalImages.forEach((img, index) => {
                if (index < 4) { // Solo las primeras 4 imágenes
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'image';
                    link.href = img.src;
                    document.head.appendChild(link);
                }
            });
        }

        // Service Worker para cacheo (opcional)
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then((registration) => {
                            console.log('🔧 SW registered: ', registration);
                        })
                        .catch((registrationError) => {
                            console.log('❌ SW registration failed: ', registrationError);
                        });
                });
            }
        }

        // Manejo de errores global
        window.addEventListener('error', (event) => {
            console.error('❌ Global error:', event.error);
            showNotification('Se produjo un error inesperado. Por favor, recarga la página.', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('❌ Unhandled promise rejection:', event.reason);
            showNotification('Error de conexión. Verifica tu internet e intenta nuevamente.', 'error');
        });

        // Funciones de estado de conexión
        function handleOnlineStatus() {
            const updateOnlineStatus = () => {
                if (navigator.onLine) {
                    showNotification('Conexión restaurada', 'success');
                    // Reintentar cargar datos si es necesario
                    if (vehicles.length === 0) {
                        loadVehiclesFromFirebase();
                    }
                } else {
                    showNotification('Sin conexión a internet. Algunas funciones pueden no estar disponibles.', 'warning');
                }
            };

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        }

        // Optimizaciones específicas para móviles
        function setupMobileOptimizations() {
            // Detectar dispositivos táctiles
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            if (isTouchDevice) {
                document.body.classList.add('touch-device');
                
                // Optimizar experiencia táctil
                document.addEventListener('touchstart', () => {}, { passive: true });
                
                // Prevenir zoom en inputs en iOS
                const viewportMeta = document.querySelector('meta[name="viewport"]');
                if (viewportMeta) {
                    viewportMeta.content += ', user-scalable=no';
                }
            }
        }

        // Funciones de configuración inicial
        function setupInitialConfiguration() {
            // Configurar tema según preferencias del sistema
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                // Usuario prefiere tema claro - podríamos agregar soporte en el futuro
                console.log('💡 User prefers light theme');
            }
            
            // Configurar reducción de movimiento si está habilitada
            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.documentElement.style.setProperty('--animation-duration', '0.1s');
                console.log('🎭 Reduced motion enabled');
            }
            
            // Configurar listeners de cambio de preferencias
            if (window.matchMedia) {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    console.log('🌙 Color scheme changed:', e.matches ? 'dark' : 'light');
                });
            }
        }

        // Funciones de limpieza y memoria
        function cleanupResources() {
            // Limpiar URLs de objeto creadas para imágenes
            const objectUrls = document.querySelectorAll('img[src^="blob:"]');
            objectUrls.forEach(img => {
                URL.revokeObjectURL(img.src);
            });
        }

        // Cleanup al cerrar/recargar página
        window.addEventListener('beforeunload', () => {
            cleanupResources();
        });

        // Inicializar aplicación cuando Firebase esté listo
        window.addEventListener('load', () => {
            // Dar tiempo a Firebase para inicializarse
            setTimeout(() => {
                initApp();
                setupInitialConfiguration();
                handleOnlineStatus();
                setupMobileOptimizations();
                enhanceModalAccessibility();
                setupSearchListeners();
            }, 1000);
        });

        // Funciones específicas mejoradas para la gestión de vehículos
        function getVehiclesByStatus(status) {
            return vehicles.filter(v => v.publicationStatus === status);
        }

        function getVehiclesByOwner(ownerRif) {
            return vehicles.filter(v => v.owner === ownerRif);
        }

        function getUsersByStatus(status) {
            return users.filter(u => u.verificationStatus === status);
        }

        function generateVehicleSlug(vehicle) {
            return `${vehicle.year}-${vehicle.brand}-${vehicle.model}`
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        // Funciones de validación mejoradas
        function validateVehicleData(data) {
            const errors = [];
            
            if (!data.year || data.year < 1990 || data.year > new Date().getFullYear() + 1) {
                errors.push('Año inválido');
            }
            
            if (!data.brand || data.brand.trim().length < 2) {
                errors.push('Marca es requerida');
            }
            
            if (!data.model || data.model.trim().length < 2) {
                errors.push('Modelo es requerido');
            }
            
            if (!data.price || data.price.trim().length < 1) {
                errors.push('Precio es requerido');
            }
            
            if (!data.images || data.images.length === 0) {
                errors.push('Al menos una imagen es requerida');
            }
            
            return errors;
        }

        function validateUserData(data) {
            const errors = [];
            
            if (!data.name || data.name.trim().length < 2) {
                errors.push('Nombre es requerido');
            }
            
            if (!data.lastname || data.lastname.trim().length < 2) {
                errors.push('Apellido es requerido');
            }
            
            if (!data.rif || !data.rif.match(/^[VEJGP]-\d{8}-\d$/)) {
                errors.push('RIF inválido (formato: J-12345678-9)');
            }
            
            if (!data.whatsapp || !data.whatsapp.match(/^\+?[\d\s\-\(\)]{10,}$/)) {
                errors.push('WhatsApp inválido');
            }
            
            if (!data.password || data.password.length < 6) {
                errors.push('Contraseña debe tener al menos 6 caracteres');
            }
            
            return errors;
        }

        // Estado de la aplicación
        const appState = {
            initialized: false,
            loading: false,
            error: null,
            lastUpdate: null
        };

        // Función para actualizar estado de la aplicación
        function updateAppState(newState) {
            Object.assign(appState, newState);
            console.log('📱 App state updated:', appState);
        }

        // Monitoreo de rendimiento básico
        function measurePerformance(name, fn) {
            const start = performance.now();
            const result = fn();
            const end = performance.now();
            console.log(`⏱️ ${name} took ${end - start} milliseconds`);
            return result;
        }

        // Función para reportar métricas de rendimiento
        function reportPerformanceMetrics() {
            if ('performance' in window) {
                const navigation = performance.getEntriesByType('navigation')[0];
                const paint = performance.getEntriesByType('paint');
                
                console.log('📊 Performance Metrics:');
                console.log('- Page Load:', navigation.loadEventEnd - navigation.loadEventStart, 'ms');
                console.log('- DOM Ready:', navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart, 'ms');
                
                paint.forEach(entry => {
                    console.log(`- ${entry.name}:`, entry.startTime, 'ms');
                });
            }
        }

        // Reportar métricas después de la carga
        window.addEventListener('load', () => {
            setTimeout(reportPerformanceMetrics, 2000);
        });
        // Funciones de búsqueda avanzada y filtros inteligentes
        function setupAdvancedSearch() {
            // Configurar búsqueda con autocompletado
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase().trim();
                    if (query.length >= 2) {
                        showSearchSuggestions(query);
                    } else {
                        hideSearchSuggestions();
                    }
                });
            }
        }

        function showSearchSuggestions(query) {
            const suggestions = generateSearchSuggestions(query);
            if (suggestions.length === 0) return;

            let suggestionsContainer = document.getElementById('searchSuggestions');
            if (!suggestionsContainer) {
                suggestionsContainer = document.createElement('div');
                suggestionsContainer.id = 'searchSuggestions';
                suggestionsContainer.className = 'search-suggestions';
                suggestionsContainer.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: var(--bg-card);
                    border: 2px solid var(--border-color);
                    border-radius: 0 0 15px 15px;
                    border-top: none;
                    max-height: 200px;
                    overflow-y: auto;
                    z-index: 1000;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                `;
                
                const searchBar = document.querySelector('.search-bar');
                searchBar.style.position = 'relative';
                searchBar.appendChild(suggestionsContainer);
            }

            suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="search-suggestion" onclick="selectSuggestion('${suggestion}')" 
                     style="padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); transition: all 0.3s ease;">
                    ${suggestion}
                </div>
            `).join('');

            // Agregar hover effects
            suggestionsContainer.querySelectorAll('.search-suggestion').forEach(item => {
                item.addEventListener('mouseenter', () => {
                    item.style.background = 'rgba(0, 212, 255, 0.1)';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'transparent';
                });
            });
        }

        function hideSearchSuggestions() {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            if (suggestionsContainer) {
                suggestionsContainer.remove();
            }
        }

        function generateSearchSuggestions(query) {
            const suggestions = new Set();
            const approvedVehicles = vehicles.filter(v => v.publicationStatus === 'approved');
            
            approvedVehicles.forEach(vehicle => {
                // Sugerencias de marca
                if (vehicle.brand.toLowerCase().includes(query)) {
                    suggestions.add(vehicle.brand);
                }
                
                // Sugerencias de modelo
                if (vehicle.model.toLowerCase().includes(query)) {
                    suggestions.add(`${vehicle.brand} ${vehicle.model}`);
                }
                
                // Sugerencias de año
                if (vehicle.year.toString().includes(query)) {
                    suggestions.add(`${vehicle.year} ${vehicle.brand}`);
                }
                
                // Sugerencias de color
                if (vehicle.color && vehicle.color.toLowerCase().includes(query)) {
                    suggestions.add(`${vehicle.color} ${vehicle.brand}`);
                }
                
                // Sugerencias de ubicación
                if (vehicle.location && vehicle.location.toLowerCase().includes(query)) {
                    suggestions.add(`Vehículos en ${vehicle.location}`);
                }
            });
            
            return Array.from(suggestions).slice(0, 5); // Máximo 5 sugerencias
        }

        function selectSuggestion(suggestion) {
            document.getElementById('searchInput').value = suggestion;
            hideSearchSuggestions();
            handleSearch();
        }

        // Funciones de filtros inteligentes
        function setupSmartFilters() {
            // Filtros que se actualizan automáticamente basados en la búsqueda actual
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', updateSmartFilters);
            }
        }

        function updateSmartFilters() {
            const currentSearch = document.getElementById('searchInput').value.toLowerCase().trim();
            const filteredVehicles = vehicles.filter(vehicle => {
                if (vehicle.publicationStatus !== 'approved') return false;
                
                if (!currentSearch) return true;
                
                return vehicle.brand.toLowerCase().includes(currentSearch) ||
                       vehicle.model.toLowerCase().includes(currentSearch) ||
                       vehicle.year.toString().includes(currentSearch) ||
                       vehicle.color?.toLowerCase().includes(currentSearch) ||
                       vehicle.location?.toLowerCase().includes(currentSearch);
            });
            
            updateFilterOptionsFromVehicles(filteredVehicles);
        }

        function updateFilterOptionsFromVehicles(vehiclesList) {
            const brands = [...new Set(vehiclesList.map(v => v.brand))].sort();
            const models = [...new Set(vehiclesList.map(v => v.model))].sort();
            const years = [...new Set(vehiclesList.map(v => v.year))].sort((a, b) => b - a);
            
            updateSelectOptionsSmooth('brandFilter', brands);
            updateSelectOptionsSmooth('modelFilter', models);
            updateSelectOptionsSmooth('yearFilter', years);
        }

        function updateSelectOptionsSmooth(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            const firstOption = select.options[0];
            
            // Animación de fade out
            select.style.opacity = '0.5';
            
            setTimeout(() => {
                select.innerHTML = '';
                select.appendChild(firstOption);
                
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                });
                
                // Restaurar valor si aún existe
                if (options.includes(currentValue)) {
                    select.value = currentValue;
                }
                
                // Animación de fade in
                select.style.opacity = '1';
            }, 150);
        }

        // Sistema de favoritos (usando localStorage como alternativa)
        function setupFavoritesSystem() {
            // Nota: Usando localStorage en lugar de sessionStorage para persistencia
            const FAVORITES_KEY = 'autoventas_favorites';
            
            window.favoritesManager = {
                getFavorites: function() {
                    try {
                        return JSON.parse(localStorage.getItem(FAVORITES_KEY) || '[]');
                    } catch {
                        return [];
                    }
                },
                
                addFavorite: function(vehicleId) {
                    const favorites = this.getFavorites();
                    if (!favorites.includes(vehicleId)) {
                        favorites.push(vehicleId);
                        localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
                        showNotification('Vehículo agregado a favoritos', 'success');
                        this.updateFavoriteButtons();
                    }
                },
                
                removeFavorite: function(vehicleId) {
                    const favorites = this.getFavorites();
                    const index = favorites.indexOf(vehicleId);
                    if (index > -1) {
                        favorites.splice(index, 1);
                        localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
                        showNotification('Vehículo removido de favoritos', 'info');
                        this.updateFavoriteButtons();
                    }
                },
                
                isFavorite: function(vehicleId) {
                    return this.getFavorites().includes(vehicleId);
                },
                
                updateFavoriteButtons: function() {
                    document.querySelectorAll('.favorite-btn').forEach(btn => {
                        const vehicleId = btn.dataset.vehicleId;
                        if (this.isFavorite(vehicleId)) {
                            btn.classList.add('active');
                            btn.innerHTML = '❤️';
                        } else {
                            btn.classList.remove('active');
                            btn.innerHTML = '🤍';
                        }
                    });
                }
            };
        }

        // Funciones de comparación de vehículos
        function setupVehicleComparison() {
            window.comparisonManager = {
                vehicles: [],
                maxVehicles: 3,
                
                addToComparison: function(vehicleId) {
                    if (this.vehicles.length >= this.maxVehicles) {
                        showNotification(`Máximo ${this.maxVehicles} vehículos para comparar`, 'warning');
                        return;
                    }
                    
                    if (!this.vehicles.includes(vehicleId)) {
                        this.vehicles.push(vehicleId);
                        showNotification('Vehículo agregado a comparación', 'success');
                        this.updateComparisonUI();
                    }
                },
                
                removeFromComparison: function(vehicleId) {
                    const index = this.vehicles.indexOf(vehicleId);
                    if (index > -1) {
                        this.vehicles.splice(index, 1);
                        showNotification('Vehículo removido de comparación', 'info');
                        this.updateComparisonUI();
                    }
                },
                
                clearComparison: function() {
                    this.vehicles = [];
                    this.updateComparisonUI();
                    showNotification('Comparación limpiada', 'info');
                },
                
                updateComparisonUI: function() {
                    // Actualizar contador en la interfaz
                    let comparisonCounter = document.getElementById('comparisonCounter');
                    if (!comparisonCounter && this.vehicles.length > 0) {
                        comparisonCounter = document.createElement('div');
                        comparisonCounter.id = 'comparisonCounter';
                        comparisonCounter.style.cssText = `
                            position: fixed;
                            bottom: 20px;
                            right: 20px;
                            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                            color: white;
                            padding: 10px 15px;
                            border-radius: 25px;
                            font-weight: 700;
                            z-index: 1000;
                            cursor: pointer;
                            box-shadow: 0 5px 15px var(--shadow-medium);
                            animation: float 2s ease-in-out infinite;
                        `;
                        comparisonCounter.onclick = () => this.showComparison();
                        document.body.appendChild(comparisonCounter);
                    }
                    
                    if (comparisonCounter) {
                        if (this.vehicles.length > 0) {
                            comparisonCounter.textContent = `Comparar (${this.vehicles.length})`;
                            comparisonCounter.style.display = 'block';
                        } else {
                            comparisonCounter.style.display = 'none';
                        }
                    }
                },
                
                showComparison: function() {
                    if (this.vehicles.length < 2) {
                        showNotification('Agrega al menos 2 vehículos para comparar', 'warning');
                        return;
                    }
                    
                    // Crear modal de comparación
                    this.createComparisonModal();
                }
            };
        }

        // Sistema de notificaciones push (simulado)
        function setupNotificationSystem() {
            if ('Notification' in window) {
                if (Notification.permission === 'default') {
                    // No solicitar automáticamente - solo cuando el usuario interactúe
                    console.log('🔔 Notifications available but not requested');
                }
            }
            
            window.notificationManager = {
                requestPermission: function() {
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                showNotification('Notificaciones activadas', 'success');
                            }
                        });
                    }
                },
                
                showBrowserNotification: function(title, options) {
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification(title, {
                            icon: '/favicon-96x96.png',
                            badge: '/favicon-96x96.png',
                            ...options
                        });
                    }
                },
                
                notifyNewVehicle: function(vehicle) {
                    this.showBrowserNotification('Nuevo vehículo disponible', {
                        body: `${vehicle.year} ${vehicle.brand} ${vehicle.model} - ${vehicle.price}`,
                        tag: 'new-vehicle'
                    });
                }
            };
        }

        // Sistema de estadísticas avanzadas
        function setupAdvancedAnalytics() {
            window.analyticsManager = {
                getPopularBrands: function() {
                    const brandCounts = {};
                    vehicles.filter(v => v.publicationStatus === 'approved').forEach(vehicle => {
                        brandCounts[vehicle.brand] = (brandCounts[vehicle.brand] || 0) + 1;
                    });
                    
                    return Object.entries(brandCounts)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 5);
                },
                
                getPriceRanges: function() {
                    const ranges = {
                        'Hasta $10,000': 0,
                        '$10,001 - $20,000': 0,
                        '$20,001 - $30,000': 0,
                        '$30,001 - $50,000': 0,
                        'Más de $50,000': 0
                    };
                    
                    vehicles.filter(v => v.publicationStatus === 'approved').forEach(vehicle => {
                        const price = parseFloat(vehicle.price.replace(/[^0-9.-]+/g, ""));
                        if (price <= 10000) ranges['Hasta $10,000']++;
                        else if (price <= 20000) ranges['$10,001 - $20,000']++;
                        else if (price <= 30000) ranges['$20,001 - $30,000']++;
                        else if (price <= 50000) ranges['$30,001 - $50,000']++;
                        else ranges['Más de $50,000']++;
                    });
                    
                    return ranges;
                },
                
                getAveragePrice: function() {
                    const approvedVehicles = vehicles.filter(v => v.publicationStatus === 'approved');
                    if (approvedVehicles.length === 0) return 0;
                    
                    const total = approvedVehicles.reduce((sum, vehicle) => {
                        return sum + parseFloat(vehicle.price.replace(/[^0-9.-]+/g, ""));
                    }, 0);
                    
                    return Math.round(total / approvedVehicles.length);
                },
                
                getMostRecentListings: function(limit = 5) {
                    return vehicles
                        .filter(v => v.publicationStatus === 'approved')
                        .sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate))
                        .slice(0, limit);
                }
            };
        }

        // Funciones de exportación e importación mejoradas
        function setupDataManagement() {
            window.dataManager = {
                exportToCSV: function(data, filename) {
                    const csvContent = this.convertToCSV(data);
                    this.downloadFile(csvContent, filename, 'text/csv');
                },
                
                convertToCSV: function(data) {
                    if (!data.length) return '';
                    
                    const headers = Object.keys(data[0]);
                    const csvRows = [headers.join(',')];
                    
                    data.forEach(row => {
                        const values = headers.map(header => {
                            const value = row[header];
                            return typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value;
                        });
                        csvRows.push(values.join(','));
                    });
                    
                    return csvRows.join('\n');
                },
                
                downloadFile: function(content, filename, contentType) {
                    const blob = new Blob([content], { type: contentType });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                generateReport: function() {
                    const report = {
                        generatedAt: new Date().toISOString(),
                        summary: {
                            totalVehicles: vehicles.length,
                            approvedVehicles: vehicles.filter(v => v.publicationStatus === 'approved').length,
                            pendingVehicles: vehicles.filter(v => v.publicationStatus === 'pending').length,
                            soldVehicles: vehicles.filter(v => v.sold).length,
                            totalUsers: users.length,
                            verifiedUsers: users.filter(u => u.verificationStatus === 'verified').length,
                            averagePrice: window.analyticsManager.getAveragePrice()
                        },
                        popularBrands: window.analyticsManager.getPopularBrands(),
                        priceRanges: window.analyticsManager.getPriceRanges(),
                        recentListings: window.analyticsManager.getMostRecentListings()
                    };
                    
                    this.downloadFile(
                        JSON.stringify(report, null, 2),
                        `autoventas_report_${new Date().toISOString().split('T')[0]}.json`,
                        'application/json'
                    );
                }
            };
        }

        // Sistema de caché inteligente
        function setupIntelligentCaching() {
            window.cacheManager = {
                cache: new Map(),
                maxSize: 100,
                
                set: function(key, value, ttl = 300000) { // 5 minutos por defecto
                    if (this.cache.size >= this.maxSize) {
                        const firstKey = this.cache.keys().next().value;
                        this.cache.delete(firstKey);
                    }
                    
                    this.cache.set(key, {
                        value,
                        expiry: Date.now() + ttl
                    });
                },
                
                get: function(key) {
                    const item = this.cache.get(key);
                    if (!item) return null;
                    
                    if (Date.now() > item.expiry) {
                        this.cache.delete(key);
                        return null;
                    }
                    
                    return item.value;
                },
                
                clear: function() {
                    this.cache.clear();
                },
                
                getStats: function() {
                    return {
                        size: this.cache.size,
                        maxSize: this.maxSize,
                        hitRate: this.hitRate || 0
                    };
                }
            };
        }

        // Función para inicializar todos los sistemas avanzados
        function initializeAdvancedFeatures() {
            setupAdvancedSearch();
            setupSmartFilters();
            setupFavoritesSystem();
            setupVehicleComparison();
            setupNotificationSystem();
            setupAdvancedAnalytics();
            setupDataManagement();
            setupIntelligentCaching();
            
            console.log('🚀 Advanced features initialized');
        }

        // Integrar con la inicialización principal
        window.addEventListener('load', () => {
            setTimeout(() => {
                initializeAdvancedFeatures();
            }, 1500);
        });
        // Sistema de validación en tiempo real mejorado
        function setupRealTimeValidation() {
            const formElements = {
                publish: {
                    form: '#publishOverlay form',
                    fields: {
                        vehicleYear: { min: 1990, max: new Date().getFullYear() + 1, type: 'number' },
                        vehicleBrand: { minLength: 2, maxLength: 50, type: 'text' },
                        vehicleModel: { minLength: 2, maxLength: 50, type: 'text' },
                        vehiclePrice: { required: true, pattern: /^[\$\d\.,\s]+$/, type: 'text' },
                        vehicleLocation: { minLength: 2, maxLength: 50, type: 'text' }
                    }
                },
                register: {
                    form: '#registerForm',
                    fields: {
                        registerName: { minLength: 2, maxLength: 30, type: 'text' },
                        registerLastname: { minLength: 2, maxLength: 30, type: 'text' },
                        registerRif: { pattern: /^[VEJGP]-\d{8}-\d$/, type: 'text' },
                        registerWhatsapp: { pattern: /^\+?[\d\s\-\(\)]{10,}$/, type: 'tel' },
                        registerPassword: { minLength: 6, maxLength: 50, type: 'password' }
                    }
                }
            };

            Object.entries(formElements).forEach(([formName, config]) => {
                Object.entries(config.fields).forEach(([fieldId, rules]) => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        setupFieldValidation(field, rules);
                    }
                });
            });
        }

        function setupFieldValidation(field, rules) {
            const validationMsg = createValidationMessage(field);

            field.addEventListener('blur', () => validateField(field, rules, validationMsg));
            field.addEventListener('input', debounce(() => {
                validateField(field, rules, validationMsg);
            }, 500));
        }

        function createValidationMessage(field) {
            let msg = field.parentNode.querySelector('.validation-message');
            if (!msg) {
                msg = document.createElement('div');
                msg.className = 'validation-message';
                msg.style.cssText = `
                    margin-top: 5px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    min-height: 20px;
                    transition: all 0.3s ease;
                `;
                field.parentNode.appendChild(msg);
            }
            return msg;
        }

        function validateField(field, rules, messageElement) {
            const value = field.value.trim();
            const errors = [];

            if (rules.required && !value) {
                errors.push('Este campo es requerido');
            }

            if (value && rules.minLength && value.length < rules.minLength) {
                errors.push(`Mínimo ${rules.minLength} caracteres`);
            }

            if (value && rules.maxLength && value.length > rules.maxLength) {
                errors.push(`Máximo ${rules.maxLength} caracteres`);
            }

            if (value && rules.min && parseFloat(value) < rules.min) {
                errors.push(`Valor mínimo: ${rules.min}`);
            }

            if (value && rules.max && parseFloat(value) > rules.max) {
                errors.push(`Valor máximo: ${rules.max}`);
            }

            if (value && rules.pattern && !rules.pattern.test(value)) {
                errors.push(getPatternErrorMessage(rules.pattern));
            }

            updateFieldValidation(field, messageElement, errors);
            return errors.length === 0;
        }

        function getPatternErrorMessage(pattern) {
            const patternMessages = {
                '/^[VEJGP]-\\d{8}-\\d$/': 'Formato: J-12345678-9',
                '/^\\+?[\\d\\s\\-\\(\\)]{10,}$/': 'Número de teléfono inválido',
                '/^[\\$\\d\\.,\\s]+$/': 'Solo números, $ y . permitidos'
            };
            
            return patternMessages[pattern.toString()] || 'Formato inválido';
        }

        function updateFieldValidation(field, messageElement, errors) {
            if (errors.length > 0) {
                field.style.borderColor = 'var(--error-color)';
                messageElement.textContent = errors[0];
                messageElement.style.color = 'var(--error-color)';
                messageElement.classList.add('error-message');
            } else if (field.value.trim()) {
                field.style.borderColor = 'var(--success-color)';
                messageElement.textContent = '✓ Válido';
                messageElement.style.color = 'var(--success-color)';
                messageElement.classList.remove('error-message');
            } else {
                field.style.borderColor = 'var(--border-color)';
                messageElement.textContent = '';
                messageElement.classList.remove('error-message');
            }
        }

        // Sistema de autoguardado para formularios largos
        function setupAutoSave() {
            const AUTOSAVE_KEY = 'autoventas_autosave';
            const AUTOSAVE_INTERVAL = 30000; // 30 segundos

            window.autoSaveManager = {
                data: {},
                intervalId: null,

                start: function(formId) {
                    this.load(formId);
                    this.intervalId = setInterval(() => {
                        this.save(formId);
                    }, AUTOSAVE_INTERVAL);
                },

                stop: function() {
                    if (this.intervalId) {
                        clearInterval(this.intervalId);
                        this.intervalId = null;
                    }
                },

                save: function(formId) {
                    const form = document.querySelector(formId);
                    if (!form) return;

                    const formData = new FormData(form);
                    const data = {};
                    
                    for (const [key, value] of formData.entries()) {
                        data[key] = value;
                    }

                    this.data[formId] = {
                        data,
                        timestamp: Date.now()
                    };

                    try {
                        localStorage.setItem(AUTOSAVE_KEY, JSON.stringify(this.data));
                        console.log('💾 Form auto-saved:', formId);
                    } catch (error) {
                        console.warn('⚠️ Auto-save failed:', error);
                    }
                },

                load: function(formId) {
                    try {
                        const saved = JSON.parse(localStorage.getItem(AUTOSAVE_KEY) || '{}');
                        const formData = saved[formId];
                        
                        if (formData && Date.now() - formData.timestamp < 24 * 60 * 60 * 1000) { // 24 horas
                            this.restoreFormData(formId, formData.data);
                            showNotification('Datos del formulario restaurados', 'info');
                        }
                    } catch (error) {
                        console.warn('⚠️ Auto-load failed:', error);
                    }
                },

                restoreFormData: function(formId, data) {
                    const form = document.querySelector(formId);
                    if (!form || !data) return;

                    Object.entries(data).forEach(([key, value]) => {
                        const field = form.querySelector(`[name="${key}"]`);
                        if (field) {
                            field.value = value;
                        }
                    });
                },

                clear: function(formId) {
                    delete this.data[formId];
                    try {
                        localStorage.setItem(AUTOSAVE_KEY, JSON.stringify(this.data));
                    } catch (error) {
                        console.warn('⚠️ Clear auto-save failed:', error);
                    }
                }
            };
        }

        // Sistema de temas avanzado
        function setupAdvancedThemes() {
            const themes = {
                default: {
                    name: 'Oscuro Premium',
                    colors: {
                        primary: '#00d4ff',
                        secondary: '#ff6b35',
                        accent: '#ffd700',
                        bgDark: '#0f0f0f',
                        bgCard: '#1a1a1a'
                    }
                },
                blue: {
                    name: 'Azul Profesional',
                    colors: {
                        primary: '#007bff',
                        secondary: '#28a745',
                        accent: '#ffc107',
                        bgDark: '#1a1a2e',
                        bgCard: '#16213e'
                    }
                },
                green: {
                    name: 'Verde Natura',
                    colors: {
                        primary: '#28a745',
                        secondary: '#007bff',
                        accent: '#fd7e14',
                        bgDark: '#0d1b0d',
                        bgCard: '#1a2f1a'
                    }
                },
                purple: {
                    name: 'Púrpura Real',
                    colors: {
                        primary: '#6f42c1',
                        secondary: '#e83e8c',
                        accent: '#fd7e14',
                        bgDark: '#1a0d1a',
                        bgCard: '#2d1b2d'
                    }
                }
            };

            window.themeManager = {
                currentTheme: 'default',
                themes,

                applyTheme: function(themeName) {
                    const theme = this.themes[themeName];
                    if (!theme) return;

                    Object.entries(theme.colors).forEach(([key, value]) => {
                        const cssVarName = '--' + key.replace(/([A-Z])/g, '-$1').toLowerCase();
                        document.documentElement.style.setProperty(cssVarName, value);
                    });

                    this.currentTheme = themeName;
                    this.saveThemePreference();
                    showNotification(`Tema cambiado a: ${theme.name}`, 'success');
                },

                saveThemePreference: function() {
                    try {
                        localStorage.setItem('autoventas_theme', this.currentTheme);
                    } catch (error) {
                        console.warn('⚠️ Could not save theme preference:', error);
                    }
                },

                loadThemePreference: function() {
                    try {
                        const saved = localStorage.getItem('autoventas_theme');
                        if (saved && this.themes[saved]) {
                            this.applyTheme(saved);
                        }
                    } catch (error) {
                        console.warn('⚠️ Could not load theme preference:', error);
                    }
                },

                createThemeSelector: function() {
                    if (document.getElementById('themeSelector')) return;

                    const selector = document.createElement('div');
                    selector.id = 'themeSelector';
                    selector.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: -200px;
                        transform: translateY(-50%);
                        background: var(--bg-card);
                        border: 2px solid var(--border-color);
                        border-radius: 0 15px 15px 0;
                        padding: 15px;
                        z-index: 1001;
                        transition: left 0.3s ease;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    `;

                    const toggle = document.createElement('button');
                    toggle.innerHTML = '🎨';
                    toggle.style.cssText = `
                        position: absolute;
                        right: -40px;
                        top: 50%;
                        transform: translateY(-50%);
                        width: 40px;
                        height: 40px;
                        background: var(--primary-color);
                        border: none;
                        border-radius: 0 10px 10px 0;
                        color: white;
                        font-size: 1.2rem;
                        cursor: pointer;
                    `;

                    toggle.onclick = () => {
                        const isOpen = selector.style.left === '0px';
                        selector.style.left = isOpen ? '-200px' : '0px';
                    };

                    const title = document.createElement('h4');
                    title.textContent = 'Temas';
                    title.style.cssText = 'color: var(--primary-color); margin-bottom: 15px; font-size: 1.1rem;';

                    selector.appendChild(toggle);
                    selector.appendChild(title);

                    Object.entries(this.themes).forEach(([key, theme]) => {
                        const button = document.createElement('button');
                        button.textContent = theme.name;
                        button.style.cssText = `
                            width: 100%;
                            padding: 8px 12px;
                            margin-bottom: 8px;
                            background: ${key === this.currentTheme ? 'var(--primary-color)' : 'rgba(255, 255, 255, 0.1)'};
                            border: 1px solid var(--border-color);
                            border-radius: 8px;
                            color: white;
                            cursor: pointer;
                            font-size: 0.9rem;
                            transition: all 0.3s ease;
                        `;

                        button.onclick = () => this.applyTheme(key);
                        selector.appendChild(button);
                    });

                    document.body.appendChild(selector);
                }
            };
        }

        // Sistema de atajos de teclado
        function setupKeyboardShortcuts() {
            const shortcuts = {
                'ctrl+k': () => {
                    if (currentSection === 'catalog') {
                        toggleSearchPanel();
                        setTimeout(() => {
                            document.getElementById('searchInput')?.focus();
                        }, 100);
                    }
                },
                'escape': () => {
                    if (searchPanelOpen) {
                        toggleSearchPanel();
                    }
                },
                'ctrl+shift+n': () => {
                    if (currentUser?.isAdmin) {
                        handlePublishClick();
                    }
                },
                'ctrl+shift+a': () => {
                    if (currentUser?.isAdmin) {
                        showSection('admin');
                    }
                },
                'ctrl+shift+d': () => {
                    if (currentUser) {
                        showSection('dashboard');
                    }
                },
                'ctrl+shift+h': () => {
                    showSection('catalog');
                }
            };

            document.addEventListener('keydown', (e) => {
                const key = [];
                if (e.ctrlKey) key.push('ctrl');
                if (e.shiftKey) key.push('shift');
                if (e.altKey) key.push('alt');
                key.push(e.key.toLowerCase());

                const shortcut = key.join('+');
                if (shortcuts[shortcut]) {
                    e.preventDefault();
                    shortcuts[shortcut]();
                }
            });

            // Mostrar ayuda de atajos
            window.showKeyboardHelp = function() {
                const helpModal = document.createElement('div');
                helpModal.className = 'overlay';
                helpModal.style.display = 'flex';
                helpModal.innerHTML = `
                    <div class="auth-modal" style="max-width: 500px;">
                        <button class="close-btn" onclick="this.closest('.overlay').remove()">&times;</button>
                        <h2 class="form-title">⌨️ Atajos de Teclado</h2>
                        <div style="text-align: left;">
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Ctrl + K</strong><br>
                                <span style="color: var(--text-muted);">Abrir búsqueda</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Escape</strong><br>
                                <span style="color: var(--text-muted);">Cerrar paneles/modales</span>
                            </div>
                            ${currentUser?.isAdmin ? `
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Ctrl + Shift + N</strong><br>
                                <span style="color: var(--text-muted);">Nueva publicación</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Ctrl + Shift + A</strong><br>
                                <span style="color: var(--text-muted);">Panel de administración</span>
                            </div>
                            ` : ''}
                            ${currentUser ? `
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Ctrl + Shift + D</strong><br>
                                <span style="color: var(--text-muted);">Mi Dashboard</span>
                            </div>
                            ` : ''}
                            <div style="margin-bottom: 15px;">
                                <strong style="color: var(--primary-color);">Ctrl + Shift + H</strong><br>
                                <span style="color: var(--text-muted);">Ir al catálogo</span>
                            </div>
                        </div>
                        <button class="form-btn secondary" onclick="this.closest('.overlay').remove()">Cerrar</button>
                    </div>
                `;
                document.body.appendChild(helpModal);
            };
        }

        // Sistema de métricas en tiempo real
        function setupRealTimeMetrics() {
            window.metricsManager = {
                startTime: Date.now(),
                pageViews: 0,
                vehicleViews: new Map(),
                searchQueries: [],

                trackPageView: function() {
                    this.pageViews++;
                    this.updateMetricsDisplay();
                },

                trackVehicleView: function(vehicleId) {
                    const current = this.vehicleViews.get(vehicleId) || 0;
                    this.vehicleViews.set(vehicleId, current + 1);
                    this.updateMetricsDisplay();
                },

                trackSearch: function(query) {
                    if (query.trim()) {
                        this.searchQueries.push({
                            query: query.trim(),
                            timestamp: Date.now()
                        });
                        
                        // Mantener solo las últimas 100 búsquedas
                        if (this.searchQueries.length > 100) {
                            this.searchQueries = this.searchQueries.slice(-100);
                        }
                    }
                },

                getSessionDuration: function() {
                    return Math.round((Date.now() - this.startTime) / 1000 / 60); // minutos
                },

                getMostViewedVehicles: function() {
                    return Array.from(this.vehicleViews.entries())
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 5);
                },

                getPopularSearches: function() {
                    const searches = {};
                    this.searchQueries.forEach(item => {
                        searches[item.query] = (searches[item.query] || 0) + 1;
                    });
                    
                    return Object.entries(searches)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 5);
                },

                updateMetricsDisplay: function() {
                    // Solo actualizar si el usuario es admin y está en la sección correspondiente
                    if (currentUser?.isAdmin && currentSection === 'admin') {
                        this.renderMetricsDashboard();
                    }
                },

                renderMetricsDashboard: function() {
                    let metricsContainer = document.getElementById('realTimeMetrics');
                    if (!metricsContainer) {
                        // Crear contenedor si no existe
                        metricsContainer = document.createElement('div');
                        metricsContainer.id = 'realTimeMetrics';
                        metricsContainer.style.cssText = `
                            background: linear-gradient(145deg, var(--bg-card), var(--bg-surface));
                            border-radius: 20px;
                            padding: 25px;
                            margin: 25px 0;
                            border: 2px solid var(--border-color);
                        `;
                        
                        const adminData = document.getElementById('adminData');
                        if (adminData) {
                            adminData.appendChild(metricsContainer);
                        }
                    }

                    metricsContainer.innerHTML = `
                        <h4 style="color: var(--primary-color); margin-bottom: 20px; font-size: 1.4rem;">📊 Métricas en Tiempo Real</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center; padding: 15px; background: rgba(0, 212, 255, 0.1); border-radius: 15px;">
                                <div style="font-size: 2rem; font-weight: 900; color: var(--primary-color);">${this.pageViews}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Vistas de Página</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: 15px;">
                                <div style="font-size: 2rem; font-weight: 900; color: var(--secondary-color);">${this.vehicleViews.size}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Vehículos Vistos</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 15px;">
                                <div style="font-size: 2rem; font-weight: 900; color: var(--accent-color);">${this.searchQueries.length}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Búsquedas Realizadas</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 15px;">
                                <div style="font-size: 2rem; font-weight: 900; color: var(--success-color);">${this.getSessionDuration()}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Minutos de Sesión</div>
                            </div>
                        </div>
                    `;
                }
            };

            // Rastrear vistas de página
            window.metricsManager.trackPageView();

            // Integrar con funciones existentes
            const originalOpenModal = openModal;
            openModal = function(vehicle) {
                window.metricsManager.trackVehicleView(vehicle.id);
                trackVehicleView(vehicle);
                return originalOpenModal(vehicle);
            };

            const originalHandleSearch = handleSearch;
            handleSearch = function() {
                const query = document.getElementById('searchInput').value;
                window.metricsManager.trackSearch(query);
                return originalHandleSearch();
            };
        }

        // Inicializar todas las funcionalidades avanzadas adicionales
        function initializeAdvancedFeatures2() {
            setupRealTimeValidation();
            setupAutoSave();
            setupAdvancedThemes();
            setupKeyboardShortcuts();
            setupRealTimeMetrics();
            
            // Cargar preferencias guardadas
            window.themeManager?.loadThemePreference();
            
            console.log('🔥 Advanced features 2 initialized');
        }

        // Integrar con la inicialización principal
        window.addEventListener('load', () => {
            setTimeout(() => {
                initializeAdvancedFeatures2();
            }, 2000);
        });
        // Finalización e inicialización completa del sistema
        
        // Sistema de configuración final y optimizaciones
        function finalizeSystemConfiguration() {
            // Configurar observers para cambios dinámicos
            setupDynamicObservers();
            
            // Optimizar rendimiento final
            performFinalOptimizations();
            
            // Configurar manejo de errores robusto
            setupRobustErrorHandling();
            
            // Aplicar configuraciones específicas del navegador
            applyBrowserSpecificOptimizations();
            
            console.log('⚙️ System configuration finalized');
        }

        function setupDynamicObservers() {
            // Observer para cambios en el DOM
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        // Optimizar nuevas imágenes agregadas
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) { // Element node
                                const images = node.querySelectorAll ? node.querySelectorAll('img') : [];
                                images.forEach(img => {
                                    if (!img.hasAttribute('loading')) {
                                        img.setAttribute('loading', 'lazy');
                                    }
                                });
                            }
                        });
                    }
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });

            // Observer para cambios de visibilidad
            if ('IntersectionObserver' in window) {
                const visibilityObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, { threshold: 0.1 });

                // Observar elementos que necesitan animaciones de entrada
                document.querySelectorAll('.vehicle-card, .dashboard-card, .stat-card').forEach(el => {
                    visibilityObserver.observe(el);
                });
            }
        }

        function performFinalOptimizations() {
            // Optimización de imágenes diferida
            setTimeout(() => {
                optimizeImages();
                preloadCriticalImages();
            }, 3000);

            // Limpiar elementos no utilizados
            cleanupUnusedElements();

            // Optimizar eventos
            optimizeEventListeners();

            // Configurar prefetch para recursos críticos
            setupResourcePrefetch();
        }

        function cleanupUnusedElements() {
            // Remover elementos temporales de carga
            const loadingElements = document.querySelectorAll('.loading-skeleton:not(.active)');
            loadingElements.forEach(el => {
                if (!el.classList.contains('active')) {
                    el.remove();
                }
            });

            // Limpiar event listeners huérfanos
            document.querySelectorAll('[data-temp-listener]').forEach(el => {
                el.removeAttribute('data-temp-listener');
            });
        }

        function optimizeEventListeners() {
            // Usar event delegation para mejor rendimiento
            document.body.addEventListener('click', (e) => {
                // Manejar clicks en botones de favoritos
                if (e.target.classList.contains('favorite-btn')) {
                    const vehicleId = e.target.dataset.vehicleId;
                    if (window.favoritesManager) {
                        if (window.favoritesManager.isFavorite(vehicleId)) {
                            window.favoritesManager.removeFavorite(vehicleId);
                        } else {
                            window.favoritesManager.addFavorite(vehicleId);
                        }
                    }
                }

                // Manejar clicks en botones de comparación
                if (e.target.classList.contains('compare-btn')) {
                    const vehicleId = e.target.dataset.vehicleId;
                    if (window.comparisonManager) {
                        window.comparisonManager.addToComparison(vehicleId);
                    }
                }
            });
        }

        function setupResourcePrefetch() {
            // Prefetch de recursos críticos
            const criticalResources = [
                'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js',
                'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js'
            ];

            criticalResources.forEach(url => {
                const link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = url;
                document.head.appendChild(link);
            });
        }

        function setupRobustErrorHandling() {
            // Manejo robusto de errores de Firebase
            window.handleFirebaseError = function(error, operation) {
                console.error(`Firebase error in ${operation}:`, error);
                
                const errorMessages = {
                    'permission-denied': 'No tienes permisos para realizar esta acción',
                    'network-error': 'Error de conexión. Verifica tu internet.',
                    'quota-exceeded': 'Límite de operaciones excedido. Intenta más tarde.',
                    'not-found': 'Recurso no encontrado',
                    'already-exists': 'El recurso ya existe'
                };

                const message = errorMessages[error.code] || 'Error inesperado. Intenta nuevamente.';
                showNotification(message, 'error');

                // Reportar error para debugging
                if (currentUser?.isAdmin) {
                    console.error('Detailed error for admin:', {
                        code: error.code,
                        message: error.message,
                        operation,
                        timestamp: new Date().toISOString()
                    });
                }
            };

            // Override de funciones Firebase para manejo de errores
            const originalSaveVehicle = saveVehicleToFirebase;
            saveVehicleToFirebase = async function(vehicleData) {
                try {
                    return await originalSaveVehicle(vehicleData);
                } catch (error) {
                    window.handleFirebaseError(error, 'saveVehicle');
                    throw error;
                }
            };
        }

        function applyBrowserSpecificOptimizations() {
            // Detectar navegador y aplicar optimizaciones específicas
            const userAgent = navigator.userAgent.toLowerCase();
            const isChrome = userAgent.includes('chrome');
            const isFirefox = userAgent.includes('firefox');
            const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');
            const isEdge = userAgent.includes('edge');

            if (isChrome) {
                // Optimizaciones para Chrome
                document.documentElement.style.setProperty('--scroll-behavior', 'smooth');
            }

            if (isFirefox) {
                // Optimizaciones para Firefox
                document.documentElement.style.setProperty('--backdrop-filter', 'none');
            }

            if (isSafari) {
                // Optimizaciones para Safari
                document.documentElement.style.setProperty('--webkit-backdrop-filter', 'blur(10px)');
            }

            console.log('🌐 Browser-specific optimizations applied');
        }

        // Sistema de monitoreo de salud de la aplicación
        function setupHealthMonitoring() {
            window.healthMonitor = {
                status: 'healthy',
                checks: {
                    firebase: false,
                    dataLoaded: false,
                    uiResponsive: true
                },

                performHealthCheck: function() {
                    // Verificar Firebase
                    this.checks.firebase = !!window.db;

                    // Verificar datos cargados
                    this.checks.dataLoaded = vehicles.length > 0 || users.length > 0;

                    // Verificar responsividad de UI
                    this.checks.uiResponsive = document.querySelectorAll('.loading-overlay[style*="flex"]').length === 0;

                    // Determinar estado general
                    const healthyChecks = Object.values(this.checks).filter(Boolean).length;
                    const totalChecks = Object.keys(this.checks).length;

                    if (healthyChecks === totalChecks) {
                        this.status = 'healthy';
                    } else if (healthyChecks >= totalChecks / 2) {
                        this.status = 'degraded';
                    } else {
                        this.status = 'unhealthy';
                    }

                    return this.status;
                },

                getHealthReport: function() {
                    return {
                        status: this.status,
                        checks: this.checks,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        performance: this.getPerformanceMetrics()
                    };
                },

                getPerformanceMetrics: function() {
                    if ('performance' in window) {
                        const navigation = performance.getEntriesByType('navigation')[0];
                        return {
                            loadTime: navigation ? navigation.loadEventEnd - navigation.loadEventStart : 0,
                            domReady: navigation ? navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart : 0,
                            memoryUsage: performance.memory ? {
                                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024)
                            } : null
                        };
                    }
                    return null;
                }
            };

            // Realizar chequeo inicial
            setTimeout(() => {
                window.healthMonitor.performHealthCheck();
                console.log('🏥 Health check:', window.healthMonitor.getHealthReport());
            }, 5000);

            // Chequeos periódicos
            setInterval(() => {
                const status = window.healthMonitor.performHealthCheck();
                if (status !== 'healthy') {
                    console.warn('⚠️ Application health degraded:', window.healthMonitor.getHealthReport());
                }
            }, 60000); // Cada minuto
        }

        // Función principal de inicialización completa
        async function initializeCompleteSystem() {
            try {
                console.log('🚀 Starting complete system initialization...');

                // Verificar prerrequisitos
                if (!window.db || !window.firebaseModules) {
                    throw new Error('Firebase not properly initialized');
                }

                // Inicializar sistemas base
                await initApp();

                // Inicializar características avanzadas
                setTimeout(() => {
                    initializeAdvancedFeatures();
                    initializeAdvancedFeatures2();
                }, 1500);

                // Finalizar configuración
                setTimeout(() => {
                    finalizeSystemConfiguration();
                    setupHealthMonitoring();
                }, 3000);

                // Configurar tema y selector
                setTimeout(() => {
                    if (window.themeManager) {
                        window.themeManager.createThemeSelector();
                    }
                }, 4000);

                // Mostrar ayuda de atajos si es la primera visita
                setTimeout(() => {
                    const isFirstVisit = !localStorage.getItem('autoventas_visited');
                    if (isFirstVisit) {
                        localStorage.setItem('autoventas_visited', 'true');
                        showNotification('¡Bienvenido! Presiona Ctrl+? para ver los atajos de teclado disponibles.', 'info');
                    }
                }, 5000);

                console.log('🎉 Complete system initialization finished successfully!');

            } catch (error) {
                console.error('❌ Critical initialization error:', error);
                hideLoading();
                showNotification('Error crítico al inicializar la aplicación. Por favor, recarga la página.', 'error');
            }
        }

        // Event listeners finales y configuración de atajos adicionales
        document.addEventListener('keydown', (e) => {
            // Atajo para ayuda (Ctrl + ?)
            if (e.ctrlKey && (e.key === '?' || e.key === '/')) {
                e.preventDefault();
                if (window.showKeyboardHelp) {
                    window.showKeyboardHelp();
                }
            }

            // Atajo para reporte de salud (Ctrl + Shift + H) - solo para admins
            if (e.ctrlKey && e.shiftKey && e.key === 'R' && currentUser?.isAdmin) {
                e.preventDefault();
                const report = window.healthMonitor?.getHealthReport();
                if (report) {
                    console.log('🏥 Health Report:', report);
                    showNotification('Reporte de salud generado en consola', 'info');
                }
            }
        });

        // Manejo de visibilidad de la página
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Página oculta - pausar operaciones no críticas
                if (window.autoSaveManager) {
                    window.autoSaveManager.stop();
                }
            } else {
                // Página visible - reanudar operaciones
                if (window.autoSaveManager && currentSection === 'publish') {
                    window.autoSaveManager.start('#publishOverlay form');
                }
                
                // Verificar si hay actualizaciones de datos
                if (Date.now() - (appState.lastUpdate || 0) > 300000) { // 5 minutos
                    loadVehiclesFromFirebase();
                }
            }
        });

        // Configuración final de Service Worker (si está disponible)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Registrar service worker para mejor rendimiento
                navigator.serviceWorker.register('/sw.js').then((registration) => {
                    console.log('🔧 ServiceWorker registration successful:', registration.scope);
                }).catch((error) => {
                    console.log('❌ ServiceWorker registration failed:', error);
                });
            });
        }

        // Inicialización final cuando todo esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initializeCompleteSystem, 1000);
            });
        } else {
            setTimeout(initializeCompleteSystem, 1000);
        }

        // Función global para debugging (solo en desarrollo)
        window.debugAutoVentas = function() {
            if (currentUser?.isAdmin) {
                const debugInfo = {
                    version: '2.0.0',
                    environment: 'production',
                    user: currentUser,
                    appState: appState,
                    vehicles: vehicles.length,
                    users: users.length,
                    config: siteConfig,
                    health: window.healthMonitor?.getHealthReport(),
                    cache: window.cacheManager?.getStats(),
                    metrics: {
                        pageViews: window.metricsManager?.pageViews,
                        sessionDuration: window.metricsManager?.getSessionDuration()
                    }
                };
                
                console.table(debugInfo);
                return debugInfo;
            } else {
                console.log('Debug info only available for administrators');
            }
        };

        // Mensaje final en consola
        setTimeout(() => {
            console.log(`
🏎️ AutoVentas Premium v2.0.0
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Sistema completamente inicializado
🔥 Todas las funcionalidades activas
📱 Optimizado para móviles y tablets
🎨 Sistema de temas disponible
⌨️  Atajos de teclado configurados
📊 Métricas en tiempo real activas
🏥 Monitoreo de salud configurado
🚀 Rendimiento optimizado

Para desarrolladores:
- Usa window.debugAutoVentas() para información de debug
- Presiona Ctrl+? para ver atajos de teclado
- Revisa la consola para métricas de rendimiento

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
            `);
        }, 6000);

    </script>
</body>
</html>
